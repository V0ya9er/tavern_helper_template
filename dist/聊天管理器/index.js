import{createPinia as e,defineStore as n}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{klona as t}from'https://testingcf.jsdelivr.net/npm/klona/+esm';var a={19(e,n,t){t.r(n),t.d(n,{default:()=>c});var a=t(492),o=t.n(a),r=t(748),A=t.n(r)()(o());A.push([e.id,'.forest-view[data-v-492ea9d4]{flex:1;overflow-y:auto;padding:8px}.forest-list[data-v-492ea9d4]{display:flex;flex-direction:column;gap:12px}.tree-group[data-v-492ea9d4]{background:hsla(0,0%,100%,.02);border:1px solid hsla(0,0%,100%,.08);border-radius:8px;overflow:hidden}.tree-header[data-v-492ea9d4]{display:flex;align-items:center;gap:10px;padding:12px 14px;background:rgba(0,0,0,.15);cursor:pointer;transition:background .15s}.tree-header[data-v-492ea9d4]:hover{background:rgba(0,0,0,.25)}.tree-header.has-current[data-v-492ea9d4]{border-left:3px solid #22c55e;background:rgba(34,197,94,.08)}.expand-btn[data-v-492ea9d4]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;opacity:.7}.expand-btn[data-v-492ea9d4]:hover{opacity:1}.tree-icon[data-v-492ea9d4]{font-size:16px;color:var(--SmartThemeBodyColor,#aaa);opacity:.8}.tree-info[data-v-492ea9d4]{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.tree-name[data-v-492ea9d4]{font-weight:500;color:var(--SmartThemeBodyColor,#fff);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.current-badge[data-v-492ea9d4]{font-size:10px;padding:2px 6px;border-radius:4px;background:#22c55e;color:#fff;font-weight:500}.tree-meta[data-v-492ea9d4]{display:flex;gap:14px;font-size:12px;color:var(--SmartThemeBodyColor,#888);opacity:.7}.tree-meta i[data-v-492ea9d4]{margin-right:4px}.select-all-btn[data-v-492ea9d4]{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#aaa);cursor:pointer;opacity:.6;transition:all .15s}.select-all-btn[data-v-492ea9d4]:hover{opacity:1;color:#3b82f6}.tree-nodes[data-v-492ea9d4]{padding:4px;display:flex;flex-direction:column;gap:2px}.empty-state[data-v-492ea9d4]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:var(--SmartThemeBodyColor,#888);opacity:.6}.empty-state i[data-v-492ea9d4]{font-size:56px;margin-bottom:16px}.empty-state p[data-v-492ea9d4]{margin:0;font-size:15px}.list-enter-active[data-v-492ea9d4],.list-leave-active[data-v-492ea9d4]{transition:all .2s ease}.list-enter-from[data-v-492ea9d4],.list-leave-to[data-v-492ea9d4]{opacity:0;transform:translateX(-10px)}.list-move[data-v-492ea9d4]{transition:transform .2s ease}','',{version:3,sources:['webpack://./src/聊天管理器/components/ForestView.vue'],names:[],mappings:'AACA,8BACE,MAAA,CACA,eAAA,CACA,WAAA,CAGF,8BACE,YAAA,CACA,qBAAA,CACA,QAAA,CAGF,6BACE,8BAAA,CACA,oCAAA,CACA,iBAAA,CACA,eAAA,CAGF,8BACE,YAAA,CACA,kBAAA,CACA,QAAA,CACA,iBAAA,CACA,0BAAA,CACA,cAAA,CACA,0BAAA,CAEA,oCACE,0BAAA,CAGF,0CACE,6BAAA,CACA,8BAAA,CAIJ,6BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,UAAA,CAEA,mCACE,SAAA,CAIJ,4BACE,cAAA,CACA,qCAAA,CACA,UAAA,CAGF,4BACE,MAAA,CACA,YAAA,CACA,kBAAA,CACA,OAAA,CACA,WAAA,CAGF,4BACE,eAAA,CACA,qCAAA,CACA,eAAA,CACA,sBAAA,CACA,kBAAA,CAGF,gCACE,cAAA,CACA,eAAA,CACA,iBAAA,CACA,kBAAA,CACA,UAAA,CACA,eAAA,CAGF,4BACE,YAAA,CACA,QAAA,CACA,cAAA,CACA,qCAAA,CACA,UAAA,CAEA,8BACE,gBAAA,CAIJ,iCACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,UAAA,CACA,mBAAA,CAEA,uCACE,SAAA,CACA,aAAA,CAIJ,6BACE,WAAA,CACA,YAAA,CACA,qBAAA,CACA,OAAA,CAGF,8BACE,YAAA,CACA,qBAAA,CACA,kBAAA,CACA,sBAAA,CACA,iBAAA,CACA,qCAAA,CACA,UAAA,CAEA,gCACE,cAAA,CACA,kBAAA,CAGF,gCACE,QAAA,CACA,cAAA,CAKJ,wEAEE,uBAAA,CAGF,kEAEE,SAAA,CACA,2BAAA,CAGF,4BACE,6BAAA',sourcesContent:['\n.forest-view {\n  flex: 1;\n  overflow-y: auto;\n  padding: 8px;\n}\n\n.forest-list {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.tree-group {\n  background: rgba(255, 255, 255, 0.02);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.tree-header {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 12px 14px;\n  background: rgba(0, 0, 0, 0.15);\n  cursor: pointer;\n  transition: background 0.15s;\n\n  &:hover {\n    background: rgba(0, 0, 0, 0.25);\n  }\n\n  &.has-current {\n    border-left: 3px solid #22c55e;\n    background: rgba(34, 197, 94, 0.08);\n  }\n}\n\n.expand-btn {\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  opacity: 0.7;\n\n  &:hover {\n    opacity: 1;\n  }\n}\n\n.tree-icon {\n  font-size: 16px;\n  color: var(--SmartThemeBodyColor, #aaa);\n  opacity: 0.8;\n}\n\n.tree-info {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  min-width: 0;\n}\n\n.tree-name {\n  font-weight: 500;\n  color: var(--SmartThemeBodyColor, #fff);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.current-badge {\n  font-size: 10px;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: #22c55e;\n  color: #fff;\n  font-weight: 500;\n}\n\n.tree-meta {\n  display: flex;\n  gap: 14px;\n  font-size: 12px;\n  color: var(--SmartThemeBodyColor, #888);\n  opacity: 0.7;\n\n  i {\n    margin-right: 4px;\n  }\n}\n\n.select-all-btn {\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #aaa);\n  cursor: pointer;\n  opacity: 0.6;\n  transition: all 0.15s;\n\n  &:hover {\n    opacity: 1;\n    color: #3b82f6;\n  }\n}\n\n.tree-nodes {\n  padding: 4px;\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 60px 20px;\n  color: var(--SmartThemeBodyColor, #888);\n  opacity: 0.6;\n\n  i {\n    font-size: 56px;\n    margin-bottom: 16px;\n  }\n\n  p {\n    margin: 0;\n    font-size: 15px;\n  }\n}\n\n// 列表动画\n.list-enter-active,\n.list-leave-active {\n  transition: all 0.2s ease;\n}\n\n.list-enter-from,\n.list-leave-to {\n  opacity: 0;\n  transform: translateX(-10px);\n}\n\n.list-move {\n  transition: transform 0.2s ease;\n}\n'],sourceRoot:''}]);const c=A},24(e,n,t){t.r(n),t.d(n,{default:()=>c});var a=t(492),o=t.n(a),r=t(748),A=t.n(r)()(o());A.push([e.id,'.chat-manager-panel[data-v-af05bb3e]{display:flex;flex-direction:column;width:95vw;max-width:1200px;height:90vh;background:var(--SmartThemeBlurTintColor,#1a1a2e);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.4);overflow:hidden;color:var(--SmartThemeBodyColor,#e0e0e0)}.panel-header[data-v-af05bb3e]{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:rgba(0,0,0,.2);border-bottom:1px solid hsla(0,0%,100%,.1)}.panel-header h2[data-v-af05bb3e]{margin:0;font-size:18px;font-weight:600;display:flex;align-items:center;gap:8px}.panel-header h2 i[data-v-af05bb3e]{opacity:.8}.close-btn[data-v-af05bb3e]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;border-radius:6px;transition:background .15s}.close-btn[data-v-af05bb3e]:hover{background:hsla(0,0%,100%,.1)}.toolbar[data-v-af05bb3e]{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid hsla(0,0%,100%,.05)}.search-box[data-v-af05bb3e]{flex:1;display:flex;align-items:center;gap:8px;padding:8px 12px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px solid hsla(0,0%,100%,.1)}.search-box i[data-v-af05bb3e]{opacity:.5}.search-box input[data-v-af05bb3e]{flex:1;background:rgba(0,0,0,0);border:none;outline:none;color:inherit;font-size:14px}.search-box input[data-v-af05bb3e]::placeholder{color:var(--SmartThemeBodyColor,#888);opacity:.5}.clear-btn[data-v-af05bb3e]{background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#888);cursor:pointer;opacity:.6}.clear-btn[data-v-af05bb3e]:hover{opacity:1}.toolbar-actions[data-v-af05bb3e]{display:flex;align-items:center;gap:8px}.sort-select[data-v-af05bb3e]{padding:6px 10px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;color:inherit;font-size:13px;cursor:pointer}.sort-select option[data-v-af05bb3e]{background:var(--SmartThemeBlurTintColor,#1a1a2e)}.icon-btn[data-v-af05bb3e]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;transition:all .15s}.icon-btn[data-v-af05bb3e]:hover{background:hsla(0,0%,100%,.1)}.batch-bar[data-v-af05bb3e]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:rgba(0,0,0,.1);border-bottom:1px solid hsla(0,0%,100%,.05)}.select-all[data-v-af05bb3e]{display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px}.select-all input[data-v-af05bb3e]{cursor:pointer}.batch-actions[data-v-af05bb3e]{display:flex;gap:8px}.batch-btn[data-v-af05bb3e]{display:flex;align-items:center;gap:4px;padding:6px 10px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;color:var(--SmartThemeBodyColor,#ccc);font-size:12px;cursor:pointer;transition:all .15s}.batch-btn[data-v-af05bb3e]:hover:not(:disabled){background:hsla(0,0%,100%,.1)}.batch-btn[data-v-af05bb3e]:disabled{opacity:.4;cursor:not-allowed}.batch-btn.danger[data-v-af05bb3e]:hover:not(:disabled){background:rgba(239,68,68,.2);border-color:rgba(239,68,68,.3);color:#ef4444}.status-bar[data-v-af05bb3e]{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;font-size:12px;color:var(--SmartThemeBodyColor,#888);opacity:.7;border-top:1px solid hsla(0,0%,100%,.05);background:rgba(0,0,0,.1)}.status-bar .error[data-v-af05bb3e]{color:#ef4444;opacity:1}.status-bar .error i[data-v-af05bb3e]{margin-right:4px}.status-bar .cache-info[data-v-af05bb3e]{display:flex;align-items:center;gap:6px}.status-bar .cache-info i[data-v-af05bb3e]{margin-right:3px}.status-bar .refreshing-indicator[data-v-af05bb3e]{background:rgba(0,0,0,0);border:none;color:inherit;padding:0;margin-left:4px}','',{version:3,sources:['webpack://./src/聊天管理器/components/MainPanel.vue'],names:[],mappings:'AACA,qCACE,YAAA,CACA,qBAAA,CACA,UAAA,CACA,gBAAA,CACA,WAAA,CACA,iDAAA,CACA,kBAAA,CACA,oCAAA,CACA,eAAA,CACA,wCAAA,CAGF,+BACE,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,iBAAA,CACA,yBAAA,CACA,0CAAA,CAEA,kCACE,QAAA,CACA,cAAA,CACA,eAAA,CACA,YAAA,CACA,kBAAA,CACA,OAAA,CAEA,oCACE,UAAA,CAKN,4BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,iBAAA,CACA,0BAAA,CAEA,kCACE,6BAAA,CAIJ,0BACE,YAAA,CACA,kBAAA,CACA,QAAA,CACA,iBAAA,CACA,2CAAA,CAGF,6BACE,MAAA,CACA,YAAA,CACA,kBAAA,CACA,OAAA,CACA,gBAAA,CACA,8BAAA,CACA,iBAAA,CACA,mCAAA,CAEA,+BACE,UAAA,CAGF,mCACE,MAAA,CACA,wBAAA,CACA,WAAA,CACA,YAAA,CACA,aAAA,CACA,cAAA,CAEA,gDACE,qCAAA,CACA,UAAA,CAKN,4BACE,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,UAAA,CAEA,kCACE,SAAA,CAIJ,kCACE,YAAA,CACA,kBAAA,CACA,OAAA,CAGF,8BACE,gBAAA,CACA,8BAAA,CACA,mCAAA,CACA,iBAAA,CACA,aAAA,CACA,cAAA,CACA,cAAA,CAEA,qCACE,iDAAA,CAIJ,2BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,8BAAA,CACA,mCAAA,CACA,iBAAA,CACA,qCAAA,CACA,cAAA,CACA,mBAAA,CAEA,iCACE,6BAAA,CAIJ,4BACE,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,gBAAA,CACA,yBAAA,CACA,2CAAA,CAGF,6BACE,YAAA,CACA,kBAAA,CACA,OAAA,CACA,cAAA,CACA,cAAA,CAEA,mCACE,cAAA,CAIJ,gCACE,YAAA,CACA,OAAA,CAGF,4BACE,YAAA,CACA,kBAAA,CACA,OAAA,CACA,gBAAA,CACA,8BAAA,CACA,mCAAA,CACA,iBAAA,CACA,qCAAA,CACA,cAAA,CACA,cAAA,CACA,mBAAA,CAEA,iDACE,6BAAA,CAGF,qCACE,UAAA,CACA,kBAAA,CAGF,wDACE,6BAAA,CACA,+BAAA,CACA,aAAA,CAIJ,6BACE,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,iBAAA,CACA,cAAA,CACA,qCAAA,CACA,UAAA,CACA,wCAAA,CACA,yBAAA,CAEA,oCACE,aAAA,CACA,SAAA,CAEA,sCACE,gBAAA,CAIJ,yCACE,YAAA,CACA,kBAAA,CACA,OAAA,CAEA,2CACE,gBAAA,CAIJ,mDACE,wBAAA,CACA,WAAA,CACA,aAAA,CACA,SAAA,CACA,eAAA',sourcesContent:['\n.chat-manager-panel {\n  display: flex;\n  flex-direction: column;\n  width: 95vw;\n  max-width: 1200px;\n  height: 90vh;\n  background: var(--SmartThemeBlurTintColor, #1a1a2e);\n  border-radius: 12px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n  overflow: hidden;\n  color: var(--SmartThemeBodyColor, #e0e0e0);\n}\n\n.panel-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 16px 20px;\n  background: rgba(0, 0, 0, 0.2);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n\n  h2 {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n\n    i {\n      opacity: 0.8;\n    }\n  }\n}\n\n.close-btn {\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  border-radius: 6px;\n  transition: background 0.15s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.1);\n  }\n}\n\n.toolbar {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.search-box {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 8px;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n\n  i {\n    opacity: 0.5;\n  }\n\n  input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    outline: none;\n    color: inherit;\n    font-size: 14px;\n\n    &::placeholder {\n      color: var(--SmartThemeBodyColor, #888);\n      opacity: 0.5;\n    }\n  }\n}\n\n.clear-btn {\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #888);\n  cursor: pointer;\n  opacity: 0.6;\n\n  &:hover {\n    opacity: 1;\n  }\n}\n\n.toolbar-actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.sort-select {\n  padding: 6px 10px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  color: inherit;\n  font-size: 13px;\n  cursor: pointer;\n\n  option {\n    background: var(--SmartThemeBlurTintColor, #1a1a2e);\n  }\n}\n\n.icon-btn {\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  transition: all 0.15s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.1);\n  }\n}\n\n.batch-bar {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 16px;\n  background: rgba(0, 0, 0, 0.1);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.select-all {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  cursor: pointer;\n  font-size: 13px;\n\n  input {\n    cursor: pointer;\n  }\n}\n\n.batch-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.batch-btn {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 6px 10px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  color: var(--SmartThemeBodyColor, #ccc);\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.15s;\n\n  &:hover:not(:disabled) {\n    background: rgba(255, 255, 255, 0.1);\n  }\n\n  &:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n  }\n\n  &.danger:hover:not(:disabled) {\n    background: rgba(239, 68, 68, 0.2);\n    border-color: rgba(239, 68, 68, 0.3);\n    color: #ef4444;\n  }\n}\n\n.status-bar {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 16px;\n  font-size: 12px;\n  color: var(--SmartThemeBodyColor, #888);\n  opacity: 0.7;\n  border-top: 1px solid rgba(255, 255, 255, 0.05);\n  background: rgba(0, 0, 0, 0.1);\n\n  .error {\n    color: #ef4444;\n    opacity: 1;\n\n    i {\n      margin-right: 4px;\n    }\n  }\n\n  .cache-info {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n\n    i {\n      margin-right: 3px;\n    }\n  }\n\n  .refreshing-indicator {\n    background: transparent;\n    border: none;\n    color: inherit;\n    padding: 0;\n    margin-left: 4px;\n  }\n}\n'],sourceRoot:''}]);const c=A},213(e,n,t){t.r(n),t.d(n,{default:()=>c});var a=t(492),o=t.n(a),r=t(748),A=t.n(r)()(o());A.push([e.id,'.chat-card[data-v-2c5b6f1e]{display:flex;align-items:center;gap:8px;padding:8px;padding-left:8px;border-radius:6px;cursor:pointer;transition:background-color .15s ease;position:relative}.chat-card[data-v-2c5b6f1e]:hover{background-color:hsla(0,0%,100%,.05)}.chat-card.is-selected[data-v-2c5b6f1e]{background-color:rgba(59,130,246,.15)}.chat-card.is-current[data-v-2c5b6f1e]{border-left:3px solid #22c55e;background-color:rgba(34,197,94,.1)}.chat-card.is-checkpoint[data-v-2c5b6f1e]{opacity:.8}.expand-btn[data-v-2c5b6f1e]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;opacity:.7}.expand-btn[data-v-2c5b6f1e]:hover{opacity:1}.expand-placeholder[data-v-2c5b6f1e]{width:20px}.tree-lines[data-v-2c5b6f1e]{position:relative;height:100%;flex-shrink:0}.tree-line[data-v-2c5b6f1e]{position:absolute;top:0;bottom:0;width:1px;background:rgba(0,0,0,0)}.tree-line.has-continuation[data-v-2c5b6f1e]{background:var(--SmartThemeBorderColor,rgba(255,255,255,0.15))}.tree-branch[data-v-2c5b6f1e]{position:absolute;width:10px;height:1px;top:50%;background:var(--SmartThemeBorderColor,rgba(255,255,255,0.15))}.tree-branch[data-v-2c5b6f1e]::before{content:"";position:absolute;left:0;width:1px;background:var(--SmartThemeBorderColor,rgba(255,255,255,0.15))}.tree-branch[data-v-2c5b6f1e]:not(.is-last)::before{top:-50vh;bottom:0;height:calc(50vh + 1px)}.tree-branch.is-last[data-v-2c5b6f1e]::before{bottom:0;height:50vh;top:auto;transform:translateY(-100%)}input[type=checkbox][data-v-2c5b6f1e]{width:16px;height:16px;cursor:pointer}.chat-icon[data-v-2c5b6f1e]{color:var(--SmartThemeBodyColor,#aaa);font-size:14px}.chat-info[data-v-2c5b6f1e]{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}.chat-header[data-v-2c5b6f1e]{display:flex;align-items:center;gap:6px}.chat-name[data-v-2c5b6f1e]{font-weight:500;color:var(--SmartThemeBodyColor,#fff);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.current-badge[data-v-2c5b6f1e],.checkpoint-badge[data-v-2c5b6f1e]{font-size:10px;padding:1px 4px;border-radius:3px;font-weight:500}.current-badge[data-v-2c5b6f1e]{background-color:#22c55e;color:#fff}.checkpoint-badge[data-v-2c5b6f1e]{background-color:#f59e0b;color:#fff}.chat-meta[data-v-2c5b6f1e]{display:flex;gap:12px;font-size:11px;color:var(--SmartThemeBodyColor,#888);opacity:.7}.chat-meta i[data-v-2c5b6f1e]{margin-right:3px}.chat-preview[data-v-2c5b6f1e]{font-size:12px;color:var(--SmartThemeBodyColor,#999);opacity:.6;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.chat-actions[data-v-2c5b6f1e]{display:flex;gap:4px;opacity:0;transition:opacity .15s ease}.chat-card:hover .chat-actions[data-v-2c5b6f1e]{opacity:1}.action-btn[data-v-2c5b6f1e]{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.1);border:none;border-radius:4px;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;transition:all .15s ease}.action-btn[data-v-2c5b6f1e]:hover{background:hsla(0,0%,100%,.2)}.action-btn.danger[data-v-2c5b6f1e]:hover{background:rgba(239,68,68,.3);color:#ef4444}.action-btn[data-v-2c5b6f1e]:disabled{opacity:.3;cursor:not-allowed}','',{version:3,sources:['webpack://./src/聊天管理器/components/ChatCard.vue'],names:[],mappings:'AACA,4BACE,YAAA,CACA,kBAAA,CACA,OAAA,CACA,WAAA,CACA,gBAAA,CACA,iBAAA,CACA,cAAA,CACA,qCAAA,CACA,iBAAA,CAEA,kCACE,oCAAA,CAGF,wCACE,qCAAA,CAGF,uCACE,6BAAA,CACA,mCAAA,CAGF,0CACE,UAAA,CAIJ,6BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,UAAA,CAEA,mCACE,SAAA,CAIJ,qCACE,UAAA,CAIF,6BACE,iBAAA,CACA,WAAA,CACA,aAAA,CAIF,4BACE,iBAAA,CACA,KAAA,CACA,QAAA,CACA,SAAA,CACA,wBAAA,CAEA,6CACE,8DAAA,CAKJ,8BACE,iBAAA,CACA,UAAA,CACA,UAAA,CACA,OAAA,CACA,8DAAA,CAEA,sCACE,UAAA,CACA,iBAAA,CACA,MAAA,CACA,SAAA,CACA,8DAAA,CAIF,oDACE,SAAA,CACA,QAAA,CACA,uBAAA,CAIF,8CACE,QAAA,CACA,WAAA,CACA,QAAA,CACA,2BAAA,CAIJ,sCACE,UAAA,CACA,WAAA,CACA,cAAA,CAGF,4BACE,qCAAA,CACA,cAAA,CAGF,4BACE,MAAA,CACA,WAAA,CACA,YAAA,CACA,qBAAA,CACA,OAAA,CAGF,8BACE,YAAA,CACA,kBAAA,CACA,OAAA,CAGF,4BACE,eAAA,CACA,qCAAA,CACA,eAAA,CACA,sBAAA,CACA,kBAAA,CAGF,mEAEE,cAAA,CACA,eAAA,CACA,iBAAA,CACA,eAAA,CAGF,gCACE,wBAAA,CACA,UAAA,CAGF,mCACE,wBAAA,CACA,UAAA,CAGF,4BACE,YAAA,CACA,QAAA,CACA,cAAA,CACA,qCAAA,CACA,UAAA,CAEA,8BACE,gBAAA,CAIJ,+BACE,cAAA,CACA,qCAAA,CACA,UAAA,CACA,eAAA,CACA,sBAAA,CACA,kBAAA,CAGF,+BACE,YAAA,CACA,OAAA,CACA,SAAA,CACA,4BAAA,CAEA,gDACE,SAAA,CAIJ,6BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,6BAAA,CACA,WAAA,CACA,iBAAA,CACA,qCAAA,CACA,cAAA,CACA,wBAAA,CAEA,mCACE,6BAAA,CAGF,0CACE,6BAAA,CACA,aAAA,CAGF,sCACE,UAAA,CACA,kBAAA',sourcesContent:['\n.chat-card {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px;\n  padding-left: 8px;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: background-color 0.15s ease;\n  position: relative;\n\n  &:hover {\n    background-color: rgba(255, 255, 255, 0.05);\n  }\n\n  &.is-selected {\n    background-color: rgba(59, 130, 246, 0.15);\n  }\n\n  &.is-current {\n    border-left: 3px solid #22c55e;\n    background-color: rgba(34, 197, 94, 0.1);\n  }\n\n  &.is-checkpoint {\n    opacity: 0.8;\n  }\n}\n\n.expand-btn {\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  opacity: 0.7;\n\n  &:hover {\n    opacity: 1;\n  }\n}\n\n.expand-placeholder {\n  width: 20px;\n}\n\n// 树形连接线容器\n.tree-lines {\n  position: relative;\n  height: 100%;\n  flex-shrink: 0;\n}\n\n// 垂直线\n.tree-line {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  width: 1px;\n  background: transparent;\n\n  &.has-continuation {\n    background: var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.15));\n  }\n}\n\n// 水平分支线\n.tree-branch {\n  position: absolute;\n  width: 10px;\n  height: 1px;\n  top: 50%;\n  background: var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.15));\n\n  &::before {\n    content: \'\';\n    position: absolute;\n    left: 0;\n    width: 1px;\n    background: var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.15));\n  }\n\n  // 非最后一个子节点：垂直线从上到下\n  &:not(.is-last)::before {\n    top: -50vh;\n    bottom: 0;\n    height: calc(50vh + 1px);\n  }\n\n  // 最后一个子节点：垂直线只到中点\n  &.is-last::before {\n    bottom: 0;\n    height: 50vh;\n    top: auto;\n    transform: translateY(-100%);\n  }\n}\n\ninput[type=\'checkbox\'] {\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n}\n\n.chat-icon {\n  color: var(--SmartThemeBodyColor, #aaa);\n  font-size: 14px;\n}\n\n.chat-info {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n\n.chat-header {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.chat-name {\n  font-weight: 500;\n  color: var(--SmartThemeBodyColor, #fff);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.current-badge,\n.checkpoint-badge {\n  font-size: 10px;\n  padding: 1px 4px;\n  border-radius: 3px;\n  font-weight: 500;\n}\n\n.current-badge {\n  background-color: #22c55e;\n  color: #fff;\n}\n\n.checkpoint-badge {\n  background-color: #f59e0b;\n  color: #fff;\n}\n\n.chat-meta {\n  display: flex;\n  gap: 12px;\n  font-size: 11px;\n  color: var(--SmartThemeBodyColor, #888);\n  opacity: 0.7;\n\n  i {\n    margin-right: 3px;\n  }\n}\n\n.chat-preview {\n  font-size: 12px;\n  color: var(--SmartThemeBodyColor, #999);\n  opacity: 0.6;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.chat-actions {\n  display: flex;\n  gap: 4px;\n  opacity: 0;\n  transition: opacity 0.15s ease;\n\n  .chat-card:hover & {\n    opacity: 1;\n  }\n}\n\n.action-btn {\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(255, 255, 255, 0.1);\n  border: none;\n  border-radius: 4px;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.2);\n  }\n\n  &.danger:hover {\n    background: rgba(239, 68, 68, 0.3);\n    color: #ef4444;\n  }\n\n  &:disabled {\n    opacity: 0.3;\n    cursor: not-allowed;\n  }\n}\n'],sourceRoot:''}]);const c=A},424(e,n,t){function a(e,n){for(var t=[],a={},o=0;o<n.length;o++){var r=n[o],A=r[0],c={id:e+':'+o,css:r[1],media:r[2],sourceMap:r[3]};a[A]?a[A].parts.push(c):t.push(a[A]={id:A,parts:[c]})}return t}t.d(n,{A:()=>f});var o='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!o)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},A=o&&(document.head||document.getElementsByTagName('head')[0]),c=null,i=0,l=!1,s=function(){},d=null,p='data-vue-ssr-id',C='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,n,t,o){l=t,d=o||{};var A=a(e,n);return u(A),function(n){for(var t=[],o=0;o<A.length;o++){var c=A[o];(i=r[c.id]).refs--,t.push(i)}n?u(A=a(e,n)):A=[];for(o=0;o<t.length;o++){var i;if(0===(i=t[o]).refs){for(var l=0;l<i.parts.length;l++)i.parts[l]();delete r[i.id]}}}}function u(e){for(var n=0;n<e.length;n++){var t=e[n],a=r[t.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](t.parts[o]);for(;o<t.parts.length;o++)a.parts.push(m(t.parts[o]));a.parts.length>t.parts.length&&(a.parts.length=t.parts.length)}else{var A=[];for(o=0;o<t.parts.length;o++)A.push(m(t.parts[o]));r[t.id]={id:t.id,refs:1,parts:A}}}}function h(){var e=document.createElement('style');return e.type='text/css',A.appendChild(e),e}function m(e){var n,t,a=document.querySelector('style['+p+'~="'+e.id+'"]');if(a){if(l)return s;a.parentNode.removeChild(a)}if(C){var o=i++;a=c||(c=h()),n=v.bind(null,a,o,!1),t=v.bind(null,a,o,!0)}else a=h(),n=x.bind(null,a),t=function(){a.parentNode.removeChild(a)};return n(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;n(e=a)}else t()}}var g,b=(g=[],function(e,n){return g[e]=n,g.filter(Boolean).join('\n')});function v(e,n,t,a){var o=t?'':a.css;if(e.styleSheet)e.styleSheet.cssText=b(n,o);else{var r=document.createTextNode(o),A=e.childNodes;A[n]&&e.removeChild(A[n]),A.length?e.insertBefore(r,A[n]):e.appendChild(r)}}function x(e,n){var t=n.css,a=n.media,o=n.sourceMap;if(a&&e.setAttribute('media',a),d.ssrId&&e.setAttribute(p,n.id),o&&(t+='\n/*# sourceURL='+o.sources[0]+' */',t+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},492(e){e.exports=function(e){var n=e[1],t=e[3];if(!t)return n;if('function'==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),o='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(a),r='/*# '.concat(o,' */');return[n].concat([r]).join('\n')}return[n].join('\n')}},502(e,n){n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t}},743(e,n,t){var a=t(19);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('25a38de1',a,!1,{ssrId:!0})},748(e){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t='',a=void 0!==n[5];return n[4]&&(t+='@supports ('.concat(n[4],') {')),n[2]&&(t+='@media '.concat(n[2],' {')),a&&(t+='@layer'.concat(n[5].length>0?' '.concat(n[5]):'',' {')),t+=e(n),a&&(t+='}'),n[2]&&(t+='}'),n[4]&&(t+='}'),t}).join('')},n.i=function(e,t,a,o,r){'string'==typeof e&&(e=[[null,e,void 0]]);var A={};if(a)for(var c=0;c<this.length;c++){var i=this[c][0];null!=i&&(A[i]=!0)}for(var l=0;l<e.length;l++){var s=[].concat(e[l]);a&&A[s[0]]||(void 0!==r&&(void 0===s[5]||(s[1]='@layer'.concat(s[5].length>0?' '.concat(s[5]):'',' {').concat(s[1],'}')),s[5]=r),t&&(s[2]?(s[1]='@media '.concat(s[2],' {').concat(s[1],'}'),s[2]=t):s[2]=t),o&&(s[4]?(s[1]='@supports ('.concat(s[4],') {').concat(s[1],'}'),s[4]=o):s[4]=''.concat(o)),n.push(s))}},n}},860(e,n,t){var a=t(24);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('badfdc6e',a,!1,{ssrId:!0})},913(e,n,t){var a=t(213);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('f7b6bbaa',a,!1,{ssrId:!0})}},o={};function r(e){var n=o[e];if(void 0!==n)return n.exports;var t=o[e]={id:e,exports:{}};return a[e](t,t.exports,r),t.exports}r.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return r.d(n,{a:n}),n},r.d=(e,n)=>{for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const A=Vue;function c(e){let n=e;for(;n.endsWith('.jsonl');)n=n.slice(0,-6);return{base:n,full:`${n}.jsonl`}}function i(e){const n=[/(\d{4}-\d{2}-\d{2})@(\d{2})h(\d{2})m(\d{2})s/,/(\d{4})(\d{2})(\d{2})-(\d{2})(\d{2})(\d{2})/,/(\d{13})/];for(const t of n){const a=e.match(t);if(a){if(t===n[0]){const[,e,n,t,o]=a;return new Date(`${e}T${n}:${t}:${o}`)}if(t===n[1]){const[,e,n,t,o,r,A]=a;return new Date(`${e}-${n}-${t}T${o}:${r}:${A}`)}if(t===n[2])return new Date(parseInt(a[1]))}}return null}function l(e,n){let t=e.replace(/\.jsonl?$/,'').replace(/\d{4}-\d{2}-\d{2}@\d{2}h\d{2}m\d{2}s\s*\d*ms/,'').replace(/\d{13}/,'').replace(new RegExp(`^${_.escapeRegExp(n)}\\s*-?\\s*`),'').trim();return t||(t=e.replace(/\.jsonl?$/,'')),t||'未命名聊天'}function s(e,n){if(!e)return'';const t=e.replace(/<[^>]+>/g,'').replace(/\*\*([^*]+)\*\*/g,'$1').replace(/\*([^*]+)\*/g,'$1').replace(/```[\s\S]*?```/g,'[代码块]').replace(/`([^`]+)`/g,'$1').replace(/\n+/g,' ').trim();return t.length<=n?t:t.slice(0,n)+'...'}function d(e){const n=e.includes('checkpoint')||e.includes('_cp_'),t=e.match(/_branch_from_(.+?)(?:_|\.)/);return{is_checkpoint:n,parent_hint:t?.[1]}}async function p(e=100){const n=getCharData('current');if(!n)return console.warn('[聊天管理器] 未选择角色卡'),[];const t=n.name,a=n.avatar,o=n.chat;console.info('[聊天管理器] 当前角色:',t,'当前聊天:',o);const r=(await async function(){try{const e=await fetch('/api/chats/recent',{method:'POST',headers:SillyTavern.getRequestHeaders(),body:JSON.stringify({metadata:!0,max:9999})});return e.ok?await e.json():(console.warn('[聊天管理器] 获取聊天 metadata 失败:',e.status),[])}catch(e){return console.error('[聊天管理器] 获取聊天 metadata 出错:',e),[]}}()).filter(e=>e.avatar===a);if(0===r.length){console.info('[聊天管理器] 原生 API 无数据，回退到 getChatHistoryBrief');const n=await getChatHistoryBrief('current');return n&&0!==n.length?function(e,n,t,a){const o=[];for(const r of e){const e=r.file_id,{base:A,full:p}=c(e),C=r.chat_items||0,f=r.mes||'',{is_checkpoint:u,parent_hint:h}=d(p),m=i(p)||new Date;o.push({file_id:A,file_name:p,display_name:l(p,n),created_at:m,updated_at:m,message_count:C,first_message_preview:s(f,a),last_message_preview:s(f,a),parent_chat:h,is_checkpoint:u,is_current:A===t||p===t})}return o}(n,t,o,e):(console.info('[聊天管理器] 该角色没有聊天记录'),[])}console.info('[聊天管理器] 获取到',r.length,'个聊天记录 (带 metadata)');const A=[];for(const n of r){const a=n.file_id,{base:r,full:p}=c(a);console.debug(`[聊天管理器] 清理文件名: "${a}" -> file_id="${r}", file_name="${p}"`);const C=n.chat_items||0,f=n.mes||'',u=n.chat_metadata?.main_chat,{is_checkpoint:h}=d(p),m=i(p)||new Date;A.push({file_id:r,file_name:p,display_name:l(p,t),created_at:m,updated_at:m,message_count:C,first_message_preview:s(f,e),last_message_preview:s(f,e),parent_chat:u,is_checkpoint:h,is_current:r===o||p===o})}return console.info('[聊天管理器] 解析完成，共',A.length,'个聊天记录'),A}function C(e,n){const t=[...e],a='asc'===n.order?1:-1;return t.sort((e,t)=>{switch(n.by){case'updated_at':return a*(e.updated_at.getTime()-t.updated_at.getTime());case'created_at':return a*(e.created_at.getTime()-t.created_at.getTime());case'name':return a*e.display_name.localeCompare(t.display_name);case'message_count':return a*(e.message_count-t.message_count);default:return 0}}),t}function f(e){const n=[];return e.forEach(function e(t){t.is_selected&&n.push(t),t.children.forEach(e)}),n}function u(e,n){e.forEach(function e(t){t.is_selected=n,t.children.forEach(e)})}function h(e,n){e.forEach(function e(t){t.is_expanded=n,t.children.forEach(e)})}async function m(e,n){const{detect_branches:t=!0,sort_config:a}=n||{},o=C(e,a||{by:'updated_at',order:'desc'});let r=new Map;if(t){r=await async function(e){const n=new Map,t=new Map;for(const n of e)t.set(n.file_id,n.file_id),t.set(n.file_name,n.file_id),t.set(n.file_name.replace(/\.jsonl?$/,''),n.file_id);for(const a of e)if(a.parent_chat){const e=t.get(a.parent_chat);e&&e!==a.file_id&&(n.set(a.file_id,e),console.info(`[聊天管理器] 分支关系: ${a.file_id} -> ${e}`))}return console.info(`[聊天管理器] 检测到 ${n.size} 个分支关系`),n}(o);for(const e of o)!e.parent_chat&&r.has(e.file_id)&&(e.parent_chat=r.get(e.file_id))}const A=new Map;for(const e of o)A.set(e.file_id,{chat:e,children:[],depth:0,is_expanded:!0,is_selected:!1});const c=[];for(const e of o){const n=A.get(e.file_id);if(e.parent_chat&&A.has(e.parent_chat)){const t=A.get(e.parent_chat);n.depth=t.depth+1,t.children.push(n)}else c.push(n)}c.forEach(function e(n){n.children.length>0&&(n.children.sort((e,n)=>n.chat.updated_at.getTime()-e.chat.updated_at.getTime()),n.children.forEach(e))});const i=c.map(e=>{const n=g(e),t=n.reduce((e,n)=>n.chat.updated_at>e?n.chat.updated_at:e,e.chat.updated_at),a=n.some(e=>e.chat.is_current);return{id:e.chat.file_id,root:e,display_name:e.chat.display_name,node_count:n.length,latest_update:t,has_current:a,is_expanded:a||n.length<=5}});return i.sort((e,n)=>e.has_current&&!n.has_current?-1:!e.has_current&&n.has_current?1:n.latest_update.getTime()-e.latest_update.getTime()),{trees:i,total_count:e.length}}function g(e){const n=[e];for(const t of e.children)n.push(...g(t));return n}const b={default_sort:{by:'updated_at',order:'desc'},preview_length:50,show_checkpoints:!0,confirm_delete:!0},v='chat_manager_settings';let x=null;const y=n('chat-manager',()=>{const e=(0,A.ref)((()=>{try{const e=getVariables({type:'global'})?.[v];return e?{...b,...e}:{...b}}catch{return{...b}}})()),n=(0,A.ref)(!1),a=(0,A.ref)(!1),o=(0,A.ref)(null),r=(0,A.ref)([]),c=(0,A.ref)({trees:[],total_count:0}),i=(0,A.ref)(''),l=(0,A.ref)(e.value.default_sort),s=(0,A.ref)(null),d=(0,A.computed)(()=>function(e,n){let t=[...e];if(!1===n.show_checkpoints&&(t=t.filter(e=>!e.is_checkpoint)),n.search?.trim()){const e=n.search.toLowerCase().trim();t=t.filter(n=>n.display_name.toLowerCase().includes(e)||n.first_message_preview.toLowerCase().includes(e)||n.last_message_preview.toLowerCase().includes(e))}return t}(r.value,{search:i.value,show_checkpoints:e.value.show_checkpoints})),C=(0,A.computed)(()=>function(e){const n=[];for(const t of e.trees)n.push(...f([t.root]));return n}(c.value)),g=(0,A.computed)(()=>C.value.length),y=(0,A.computed)(()=>function(e){return e.total_count}(c.value)),B=(0,A.computed)(()=>r.value.find(e=>e.is_current));function k(e){const n=getCharData('current');n&&(x={chats:e,timestamp:Date.now(),character:n.name},s.value=new Date)}async function E(t=!1){if(o.value=null,!t&&function(){if(!x)return!1;const e=getCharData('current');if(!e)return!1;const n=Date.now(),t=x.character===e.name,a=n-x.timestamp<3e5;return t&&a}()&&x)return console.info('[聊天管理器] 使用缓存数据'),r.value=x.chats,s.value=new Date(x.timestamp),await w(),void async function(){if(a.value)return;a.value=!0;try{const n=await p(e.value.preview_length);JSON.stringify(n.map(e=>e.file_id))!==JSON.stringify(r.value.map(e=>e.file_id))?(console.info('[聊天管理器] 后台刷新检测到变化，更新视图'),r.value=n,k(n),await w()):k(n)}catch(e){console.warn('[聊天管理器] 后台刷新失败:',e)}finally{a.value=!1}}();n.value=!0;try{const n=await p(e.value.preview_length);r.value=n,k(n),await w(),console.info(`[聊天管理器] 已加载 ${r.value.length} 个聊天记录`)}catch(e){o.value=e instanceof Error?e.message:'加载聊天记录失败',console.error('[聊天管理器]',o.value,e)}finally{n.value=!1}}async function w(){c.value=await m(d.value,{detect_branches:!0,sort_config:l.value})}function S(){x=null,s.value=null}async function N(e,n){console.log('[聊天管理器] deleteChatDirect 输入:',{avatar_url:e,chat_file:n});let t=n,a=0;for(;t.endsWith('.jsonl');)t=t.slice(0,-6),a++;const o=`${t}.jsonl`;console.log(`[聊天管理器] 文件名处理: 移除了 ${a} 个 .jsonl, 最终: ${o}`);const r=`chats/${e.replace('.png','')}/${o}`;console.log(`[聊天管理器] 预期服务器路径: ${r}`);try{const n=SillyTavern.getRequestHeaders(),t={avatar_url:e,chatfile:o};console.info('[聊天管理器] 请求详情:',{url:'/api/chats/delete',method:'POST',headers:JSON.stringify(n),body:JSON.stringify(t)});const a=await fetch('/api/chats/delete',{method:'POST',headers:n,body:JSON.stringify(t)}),r=await a.text();return console.info(`[聊天管理器] API 响应: status=${a.status}, statusText=${a.statusText}, body="${r}"`),a.ok?(console.info(`[聊天管理器] ✅ 删除成功: ${o}`),!0):(console.error(`[聊天管理器] ❌ 删除失败: HTTP ${a.status} - ${r}`),!1)}catch(e){return console.error('[聊天管理器] ❌ 删除请求异常:',e),!1}}async function T(e){if(console.log('[聊天管理器] ========== 开始删除操作 =========='),console.log('[聊天管理器] 要删除的 file_ids:',e),0===e.length)return;const n=getCharData('current');if(console.log('[聊天管理器] char_data:',JSON.stringify(n,null,2)),!n)return void console.error('[聊天管理器] 无法获取角色信息');const t=n.avatar;console.log('[聊天管理器] avatar_url:',t);const a=SillyTavern.getRequestHeaders();console.log('[聊天管理器] 验证请求头:',{'Content-Type':a['Content-Type'],'X-CSRF-TOKEN':a['X-CSRF-TOKEN']?'(已设置)':'(未设置)'});const o=new Map;for(const e of r.value)o.set(e.file_id,e.file_name);for(const n of e){const e=r.value.find(e=>e.file_id===n);console.log(`[聊天管理器] file_id "${n}" 对应的 ChatInfo:`,e)}const A=B.value?.file_id,c=A&&e.includes(A),i=new Set(e),l=[...r.value];r.value=r.value.filter(e=>!i.has(e.file_id)),await w();let s=0,d=0;const p=[];for(const n of e){const a=l.find(e=>e.file_id===n),o=a?.file_name||n;console.log(`[聊天管理器] 使用文件名: ${o} (来自 file_name: ${!!a?.file_name})`);await N(t,o)?s++:(d++,p.push(n)),e.length>1&&await new Promise(e=>setTimeout(e,100))}if(await new Promise(e=>setTimeout(e,500)),S(),await E(!0),c&&r.value.length>0){const e=r.value[0];await SillyTavern.openCharacterChat(e.file_id),e.is_current=!0}return d>0&&(console.warn(`[聊天管理器] 删除完成: 成功 ${s}, 失败 ${d}`,p),toastr.warning(`部分删除失败: 成功 ${s}, 失败 ${d}`)),{success_count:s,fail_count:d}}return(0,A.watch)(l,w,{deep:!0}),(0,A.watch)(()=>e.value.show_checkpoints,w),(0,A.watch)(i,w),{settings:e,is_loading:n,is_background_loading:a,error_message:o,chats:r,forest:c,search_keyword:i,sort_config:l,cache_time:s,filtered_chats:d,selected_nodes:C,selected_count:g,total_count:y,current_chat:B,loadChats:E,rebuildForest:w,selectAll:function(e){!function(e,n){for(const t of e.trees)u([t.root],n)}(c.value,e)},expandAll:function(e){!function(e,n){for(const t of e.trees)t.is_expanded=n,h([t.root],n)}(c.value,e)},openChat:async function(e){try{await SillyTavern.openCharacterChat(e),toastr.success('已切换聊天');for(const n of r.value)n.is_current=n.file_id===e}catch(e){toastr.error('切换聊天失败'),console.error('[聊天管理器] 切换聊天失败:',e)}},deleteChats:T,deleteSelected:async function(){const t=C.value.map(e=>e.chat.file_id);if(0!==t.length){if(e.value.confirm_delete){if(await SillyTavern.callGenericPopup(`确定要删除选中的 ${t.length} 个聊天记录吗？\n\n此操作不可撤销！`,SillyTavern.POPUP_TYPE.CONFIRM)!==SillyTavern.POPUP_RESULT.AFFIRMATIVE)return}try{n.value=!0,await T(t),toastr.success(`已删除 ${t.length} 个聊天记录`)}catch(e){toastr.error('删除聊天记录时出错')}finally{n.value=!1}}else toastr.warning('请先选择要删除的聊天记录')},renameChat:async function(e,n){try{await SillyTavern.renameChat(e,n),toastr.success('重命名成功'),await E()}catch(e){toastr.error('重命名失败'),console.error('[聊天管理器] 重命名失败:',e)}},saveSettings:function(){try{updateVariablesWith(n=>(n[v]=t(e.value),n),{type:'global'})}catch(e){console.error('[聊天管理器] 保存设置失败:',e)}},invalidateCache:S}}),B={key:1,class:'expand-placeholder'},k=['checked'],E={class:'chat-header'},w=['title'],S={key:0,class:'current-badge'},N={key:1,class:'checkpoint-badge'},T={class:'chat-meta'},V={class:'message-count'},F={class:'update-time'},D=['title'],U={class:'chat-actions'},I=['disabled'],M=(0,A.defineComponent)({__name:'ChatCard',props:{node:{},isLastChild:{type:Boolean},ancestorContinuations:{}},emits:['toggle-expand','toggle-select','open','rename','delete'],setup(e){const n=e;function t(e){return!!n.ancestorContinuations&&(n.ancestorContinuations[e]??!1)}const a=(0,A.computed)(()=>n.node.chat.is_checkpoint?'fa fa-bookmark':n.node.children.length>0?'fa fa-folder-o':'fa fa-file-text-o');function o(e){const n=(new Date).getTime()-e.getTime(),t=Math.floor(n/6e4);if(t<1)return'刚刚';if(t<60)return`${t} 分钟前`;const a=Math.floor(t/60);if(a<24)return`${a} 小时前`;const o=Math.floor(a/24);return o<7?`${o} 天前`:e.toLocaleDateString('zh-CN',{year:'numeric',month:'short',day:'numeric'})}return(n,r)=>((0,A.openBlock)(),(0,A.createElementBlock)('div',{class:(0,A.normalizeClass)(['chat-card',{'is-current':e.node.chat.is_current,'is-selected':e.node.is_selected,'is-checkpoint':e.node.chat.is_checkpoint,'has-children':e.node.children.length>0}])},[(0,A.createCommentVNode)(' 树形连接线区域 '),(0,A.createElementVNode)('div',{class:'tree-lines',style:(0,A.normalizeStyle)({width:20*e.node.depth+'px'})},[((0,A.openBlock)(!0),(0,A.createElementBlock)(A.Fragment,null,(0,A.renderList)(e.node.depth,e=>((0,A.openBlock)(),(0,A.createElementBlock)('span',{key:e,class:(0,A.normalizeClass)(['tree-line',{'has-continuation':t(e-1)}]),style:(0,A.normalizeStyle)({left:20*(e-1)+10+'px'})},null,6))),128)),(0,A.createCommentVNode)(' 水平连接线 '),e.node.depth>0?((0,A.openBlock)(),(0,A.createElementBlock)('span',{key:0,class:(0,A.normalizeClass)(['tree-branch',{'is-last':e.isLastChild}]),style:(0,A.normalizeStyle)({left:20*(e.node.depth-1)+10+'px'})},null,6)):(0,A.createCommentVNode)('v-if',!0)],4),(0,A.createCommentVNode)(' 展开/折叠按钮 '),e.node.children.length>0?((0,A.openBlock)(),(0,A.createElementBlock)('button',{key:0,class:'expand-btn',onClick:r[0]||(r[0]=(0,A.withModifiers)(e=>n.$emit('toggle-expand'),['stop']))},[(0,A.createElementVNode)('i',{class:(0,A.normalizeClass)(e.node.is_expanded?'fa fa-chevron-down':'fa fa-chevron-right')},null,2)])):((0,A.openBlock)(),(0,A.createElementBlock)('span',B)),(0,A.createCommentVNode)(' 选择框 '),(0,A.createElementVNode)('input',{type:'checkbox',checked:e.node.is_selected,onChange:r[1]||(r[1]=e=>n.$emit('toggle-select')),onClick:r[2]||(r[2]=(0,A.withModifiers)(()=>{},['stop']))},null,40,k),(0,A.createCommentVNode)(' 图标 '),(0,A.createElementVNode)('i',{class:(0,A.normalizeClass)([(0,A.unref)(a),'chat-icon'])},null,2),(0,A.createCommentVNode)(' 聊天信息 '),(0,A.createElementVNode)('div',{class:'chat-info',onClick:r[3]||(r[3]=e=>n.$emit('open'))},[(0,A.createElementVNode)('div',E,[(0,A.createElementVNode)('span',{class:'chat-name',title:e.node.chat.file_name},(0,A.toDisplayString)(e.node.chat.display_name),9,w),e.node.chat.is_current?((0,A.openBlock)(),(0,A.createElementBlock)('span',S,'当前')):(0,A.createCommentVNode)('v-if',!0),e.node.chat.is_checkpoint?((0,A.openBlock)(),(0,A.createElementBlock)('span',N,'检查点')):(0,A.createCommentVNode)('v-if',!0)]),(0,A.createElementVNode)('div',T,[(0,A.createElementVNode)('span',V,[r[7]||(r[7]=(0,A.createElementVNode)('i',{class:'fa fa-comment-o'},null,-1)),(0,A.createTextVNode)(' '+(0,A.toDisplayString)(e.node.chat.message_count)+' 条 ',1)]),(0,A.createElementVNode)('span',F,[r[8]||(r[8]=(0,A.createElementVNode)('i',{class:'fa fa-clock-o'},null,-1)),(0,A.createTextVNode)(' '+(0,A.toDisplayString)(o(e.node.chat.updated_at)),1)])]),(0,A.createElementVNode)('div',{class:'chat-preview',title:e.node.chat.last_message_preview},(0,A.toDisplayString)(e.node.chat.last_message_preview||'(空)'),9,D)]),(0,A.createCommentVNode)(' 操作按钮 '),(0,A.createElementVNode)('div',U,[(0,A.createElementVNode)('button',{class:'action-btn',title:'打开',onClick:r[4]||(r[4]=(0,A.withModifiers)(e=>n.$emit('open'),['stop']))},[...r[9]||(r[9]=[(0,A.createElementVNode)('i',{class:'fa fa-external-link'},null,-1)])]),(0,A.createElementVNode)('button',{class:'action-btn',title:'重命名',onClick:r[5]||(r[5]=(0,A.withModifiers)(e=>n.$emit('rename'),['stop']))},[...r[10]||(r[10]=[(0,A.createElementVNode)('i',{class:'fa fa-pencil'},null,-1)])]),(0,A.createElementVNode)('button',{class:'action-btn danger',title:'删除',disabled:e.node.chat.is_current,onClick:r[6]||(r[6]=(0,A.withModifiers)(e=>n.$emit('delete'),['stop']))},[...r[11]||(r[11]=[(0,A.createElementVNode)('i',{class:'fa fa-trash-o'},null,-1)])],8,I)])],2))}});r(913);var O=r(502);const j=(0,O.A)(M,[['__scopeId','data-v-2c5b6f1e']]),G={class:'forest-view'},P={key:0,class:'empty-state'},q={key:1,class:'forest-list'},Y=['onClick'],J={class:'expand-btn'},W={class:'tree-info'},R={class:'tree-name'},L={key:0,class:'current-badge'},Q={class:'tree-meta'},K={class:'node-count'},H={class:'update-time'},X=['onClick'],Z=(0,A.defineComponent)({__name:'ForestView',props:{forest:{}},emits:['open-chat','rename-chat','delete-chat'],setup(e){function n(e){const n=[];return function e(t,a=[]){for(let o=0;o<t.length;o++){const r=t[o],A=o===t.length-1;n.push({node:r,isLastChild:A,ancestorContinuations:[...a]}),r.is_expanded&&r.children.length>0&&e(r.children,[...a,!A])}}([e.root]),n}function t(e){return function e(n){return!!n.is_selected&&n.children.every(e)}(e.root)}function a(e){const n=(new Date).getTime()-e.getTime(),t=Math.floor(n/6e4);if(t<1)return'刚刚';if(t<60)return`${t} 分钟前`;const a=Math.floor(t/60);if(a<24)return`${a} 小时前`;const o=Math.floor(a/24);return o<7?`${o} 天前`:e.toLocaleDateString('zh-CN',{year:'numeric',month:'short',day:'numeric'})}return(o,r)=>((0,A.openBlock)(),(0,A.createElementBlock)('div',G,[0===e.forest.trees.length?((0,A.openBlock)(),(0,A.createElementBlock)('div',P,[...r[0]||(r[0]=[(0,A.createElementVNode)('i',{class:'fa fa-inbox'},null,-1),(0,A.createElementVNode)('p',null,'暂无聊天记录',-1)])])):((0,A.openBlock)(),(0,A.createElementBlock)('div',q,[((0,A.openBlock)(!0),(0,A.createElementBlock)(A.Fragment,null,(0,A.renderList)(e.forest.trees,e=>((0,A.openBlock)(),(0,A.createElementBlock)('div',{key:e.id,class:'tree-group'},[(0,A.createCommentVNode)(' 树标题栏 '),(0,A.createElementVNode)('div',{class:(0,A.normalizeClass)(['tree-header',{'has-current':e.has_current}]),onClick:n=>function(e){e.is_expanded=!e.is_expanded}(e)},[(0,A.createElementVNode)('button',J,[(0,A.createElementVNode)('i',{class:(0,A.normalizeClass)(e.is_expanded?'fa fa-chevron-down':'fa fa-chevron-right')},null,2)]),(0,A.createElementVNode)('i',{class:(0,A.normalizeClass)([e.node_count>1?'fa fa-code-fork':'fa fa-file-text-o','tree-icon'])},null,2),(0,A.createElementVNode)('div',W,[(0,A.createElementVNode)('span',R,(0,A.toDisplayString)(e.display_name),1),e.has_current?((0,A.openBlock)(),(0,A.createElementBlock)('span',L,'当前')):(0,A.createCommentVNode)('v-if',!0)]),(0,A.createElementVNode)('div',Q,[(0,A.createElementVNode)('span',K,[r[1]||(r[1]=(0,A.createElementVNode)('i',{class:'fa fa-comments-o'},null,-1)),(0,A.createTextVNode)(' '+(0,A.toDisplayString)(e.node_count)+' 个聊天 ',1)]),(0,A.createElementVNode)('span',H,[r[2]||(r[2]=(0,A.createElementVNode)('i',{class:'fa fa-clock-o'},null,-1)),(0,A.createTextVNode)(' '+(0,A.toDisplayString)(a(e.latest_update)),1)])]),(0,A.createElementVNode)('button',{class:'select-all-btn',title:'选择整棵树',onClick:(0,A.withModifiers)(n=>function(e,n){!function e(t){t.is_selected=n,t.children.forEach(e)}(e.root)}(e,!t(e)),['stop'])},[(0,A.createElementVNode)('i',{class:(0,A.normalizeClass)(t(e)?'fa fa-check-square-o':'fa fa-square-o')},null,2)],8,X)],10,Y),(0,A.createCommentVNode)(' 树节点列表 '),e.is_expanded?((0,A.openBlock)(),(0,A.createBlock)(A.TransitionGroup,{key:0,name:'list',tag:'div',class:'tree-nodes'},{default:(0,A.withCtx)(()=>[((0,A.openBlock)(!0),(0,A.createElementBlock)(A.Fragment,null,(0,A.renderList)(n(e),e=>((0,A.openBlock)(),(0,A.createBlock)(j,{key:e.node.chat.file_id,node:e.node,'is-last-child':e.isLastChild,'ancestor-continuations':e.ancestorContinuations,onToggleExpand:n=>{var t;(t=e.node).is_expanded=!t.is_expanded},onToggleSelect:n=>{var t;(t=e.node).is_selected=!t.is_selected},onOpen:n=>o.$emit('open-chat',e.node.chat.file_id),onRename:n=>o.$emit('rename-chat',e.node.chat.file_id),onDelete:n=>o.$emit('delete-chat',e.node.chat.file_id)},null,8,['node','is-last-child','ancestor-continuations','onToggleExpand','onToggleSelect','onOpen','onRename','onDelete']))),128))]),_:2},1024)):(0,A.createCommentVNode)('v-if',!0)]))),128))]))]))}});r(743);const ee=(0,O.A)(Z,[['__scopeId','data-v-492ea9d4']]),ne={class:'chat-manager-panel'},te={class:'panel-header'},ae={class:'toolbar'},oe={class:'search-box'},re={class:'toolbar-actions'},Ae=['title'],ce={class:'batch-bar'},ie={class:'select-all'},le=['checked','indeterminate'],se={class:'batch-actions'},de=['disabled'],pe=['disabled'],Ce=['disabled'],fe={class:'status-bar'},ue={key:0,class:'error'},he={key:0,class:'cache-info'},me={key:0,class:'refreshing-indicator',disabled:''},ge=(0,A.defineComponent)({__name:'MainPanel',emits:['close'],setup(e){const n=y(),t=(0,A.computed)({get:()=>n.sort_config.by,set:e=>{n.sort_config.by=e}}),a=(0,A.computed)({get:()=>n.sort_config.order,set:e=>{n.sort_config.order=e}});function o(){a.value='desc'===a.value?'asc':'desc'}const r=(0,A.computed)(()=>n.total_count>0&&n.selected_count===n.total_count),c=(0,A.computed)(()=>n.selected_count>0&&n.selected_count<n.total_count);function i(){n.selectAll(!r.value)}async function l(e){await n.openChat(e)}async function s(e){const t=n.chats.find(n=>n.file_id===e);if(!t)return;const a=await SillyTavern.callGenericPopup('请输入新的聊天名称:',SillyTavern.POPUP_TYPE.INPUT,t.display_name);a&&'string'==typeof a&&a.trim()&&await n.renameChat(e,a.trim())}async function d(e){const t=n.chats.find(n=>n.file_id===e);if(t)if(t.is_current)toastr.warning('无法删除当前正在使用的聊天');else{if(n.settings.confirm_delete){if(await SillyTavern.callGenericPopup(`确定要删除聊天 "${t.display_name}" 吗？\n\n此操作不可撤销！`,SillyTavern.POPUP_TYPE.CONFIRM)!==SillyTavern.POPUP_RESULT.AFFIRMATIVE)return}try{await n.deleteChats([e]),toastr.success('已删除聊天')}catch{toastr.error('删除失败')}}}function p(e){const n=new Date,t=Math.floor((n.getTime()-e.getTime())/1e3);return t<5?'刚刚':t<60?`${t}秒前`:t<3600?`${Math.floor(t/60)}分钟前`:'已过期'}return(0,A.onMounted)(()=>{n.loadChats()}),(e,C)=>((0,A.openBlock)(),(0,A.createElementBlock)('div',ne,[(0,A.createCommentVNode)(' 标题栏 '),(0,A.createElementVNode)('div',te,[C[9]||(C[9]=(0,A.createElementVNode)('h2',null,[(0,A.createElementVNode)('i',{class:'fa fa-comments-o'}),(0,A.createTextVNode)(' 聊天管理器 ')],-1)),(0,A.createElementVNode)('button',{class:'close-btn',onClick:C[0]||(C[0]=n=>e.$emit('close'))},[...C[8]||(C[8]=[(0,A.createElementVNode)('i',{class:'fa fa-times'},null,-1)])])]),(0,A.createCommentVNode)(' 工具栏 '),(0,A.createElementVNode)('div',ae,[(0,A.createElementVNode)('div',oe,[C[11]||(C[11]=(0,A.createElementVNode)('i',{class:'fa fa-search'},null,-1)),(0,A.withDirectives)((0,A.createElementVNode)('input',{'onUpdate:modelValue':C[1]||(C[1]=e=>(0,A.unref)(n).search_keyword=e),type:'text',placeholder:'搜索聊天...'},null,512),[[A.vModelText,(0,A.unref)(n).search_keyword]]),(0,A.unref)(n).search_keyword?((0,A.openBlock)(),(0,A.createElementBlock)('button',{key:0,class:'clear-btn',onClick:C[2]||(C[2]=e=>(0,A.unref)(n).search_keyword='')},[...C[10]||(C[10]=[(0,A.createElementVNode)('i',{class:'fa fa-times-circle'},null,-1)])])):(0,A.createCommentVNode)('v-if',!0)]),(0,A.createElementVNode)('div',re,[(0,A.withDirectives)((0,A.createElementVNode)('select',{'onUpdate:modelValue':C[3]||(C[3]=e=>(0,A.isRef)(t)?t.value=e:null),class:'sort-select'},[...C[12]||(C[12]=[(0,A.createElementVNode)('option',{value:'updated_at'},'按更新时间',-1),(0,A.createElementVNode)('option',{value:'created_at'},'按创建时间',-1),(0,A.createElementVNode)('option',{value:'name'},'按名称',-1),(0,A.createElementVNode)('option',{value:'message_count'},'按消息数',-1)])],512),[[A.vModelSelect,(0,A.unref)(t)]]),(0,A.createElementVNode)('button',{class:'icon-btn',title:'desc'===(0,A.unref)(a)?'降序':'升序',onClick:o},[(0,A.createElementVNode)('i',{class:(0,A.normalizeClass)('desc'===(0,A.unref)(a)?'fa fa-sort-amount-desc':'fa fa-sort-amount-asc')},null,2)],8,Ae),(0,A.createElementVNode)('button',{class:'icon-btn',title:'刷新',onClick:C[4]||(C[4]=e=>(0,A.unref)(n).loadChats())},[(0,A.createElementVNode)('i',{class:(0,A.normalizeClass)(['fa fa-refresh',{'fa-spin':(0,A.unref)(n).is_loading}])},null,2)])])]),(0,A.createCommentVNode)(' 批量操作栏 '),(0,A.createElementVNode)('div',ce,[(0,A.createElementVNode)('label',ie,[(0,A.createElementVNode)('input',{type:'checkbox',checked:(0,A.unref)(r),indeterminate:(0,A.unref)(c),onChange:i},null,40,le),C[13]||(C[13]=(0,A.createElementVNode)('span',null,'全选',-1))]),(0,A.createElementVNode)('div',se,[(0,A.createElementVNode)('button',{class:'batch-btn',disabled:0===(0,A.unref)(n).selected_count,onClick:C[5]||(C[5]=e=>(0,A.unref)(n).expandAll(!0))},[...C[14]||(C[14]=[(0,A.createElementVNode)('i',{class:'fa fa-expand'},null,-1),(0,A.createTextVNode)(' 展开全部 ',-1)])],8,de),(0,A.createElementVNode)('button',{class:'batch-btn',disabled:0===(0,A.unref)(n).selected_count,onClick:C[6]||(C[6]=e=>(0,A.unref)(n).expandAll(!1))},[...C[15]||(C[15]=[(0,A.createElementVNode)('i',{class:'fa fa-compress'},null,-1),(0,A.createTextVNode)(' 折叠全部 ',-1)])],8,pe),(0,A.createElementVNode)('button',{class:'batch-btn danger',disabled:0===(0,A.unref)(n).selected_count,onClick:C[7]||(C[7]=e=>(0,A.unref)(n).deleteSelected())},[C[16]||(C[16]=(0,A.createElementVNode)('i',{class:'fa fa-trash-o'},null,-1)),(0,A.createTextVNode)(' 删除选中 ('+(0,A.toDisplayString)((0,A.unref)(n).selected_count)+') ',1)],8,Ce)])]),(0,A.createCommentVNode)(' 聊天列表 '),(0,A.createVNode)(ee,{forest:(0,A.unref)(n).forest,onOpenChat:l,onRenameChat:s,onDeleteChat:d},null,8,['forest']),(0,A.createCommentVNode)(' 状态栏 '),(0,A.createElementVNode)('div',fe,[(0,A.unref)(n).error_message?((0,A.openBlock)(),(0,A.createElementBlock)('span',ue,[C[17]||(C[17]=(0,A.createElementVNode)('i',{class:'fa fa-exclamation-triangle'},null,-1)),(0,A.createTextVNode)(' '+(0,A.toDisplayString)((0,A.unref)(n).error_message),1)])):((0,A.openBlock)(),(0,A.createElementBlock)(A.Fragment,{key:1},[(0,A.createElementVNode)('span',null,'已选中 '+(0,A.toDisplayString)((0,A.unref)(n).selected_count)+' 个 | 共 '+(0,A.toDisplayString)((0,A.unref)(n).total_count)+' 个聊天',1),(0,A.unref)(n).cache_time?((0,A.openBlock)(),(0,A.createElementBlock)('span',he,[C[19]||(C[19]=(0,A.createElementVNode)('i',{class:'fa fa-database'},null,-1)),(0,A.createTextVNode)(' 缓存: '+(0,A.toDisplayString)(p((0,A.unref)(n).cache_time))+' ',1),(0,A.unref)(n).is_background_loading?((0,A.openBlock)(),(0,A.createElementBlock)('button',me,[...C[18]||(C[18]=[(0,A.createElementVNode)('i',{class:'fa fa-refresh fa-spin'},null,-1)])])):(0,A.createCommentVNode)('v-if',!0)])):(0,A.createCommentVNode)('v-if',!0)],64))])]))}});r(860);const be=(0,O.A)(ge,[['__scopeId','data-v-af05bb3e']]);let ve=!1,xe=null,ye=null;function _e(){if(ve)return void Be();if(!getCharData('current'))return void toastr.warning('请先选择一个角色卡');ye=$('<div>').attr('script_id',getScriptId()),ye.addClass('chat-manager-container'),ye.css({position:'fixed',top:0,left:0,right:0,bottom:0,display:'flex',alignItems:'center',justifyContent:'center',backgroundColor:'rgba(0, 0, 0, 0.5)',zIndex:9999}),ye.on('click',e=>{e.target===ye[0]&&Be()}),$(document).on('keydown.chat-manager',e=>{'Escape'===e.key&&Be()}),$('body').append(ye),function(){if($(`head > div[script_id="${getScriptId()}"]`).length>0)return;const e=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone());$('head').append(e)}();const n=$('<div>').appendTo(ye);xe=(0,A.createApp)(be,{onClose:Be}),xe.use(e()),xe.mount(n[0]),ve=!0,console.info('[聊天管理器] 已打开')}function Be(){ve&&($(document).off('keydown.chat-manager'),xe&&(xe.unmount(),xe=null),ye&&(ye.remove(),ye=null),$(`head > div[script_id="${getScriptId()}"]`).remove(),ve=!1,console.info('[聊天管理器] 已关闭'))}$(()=>{replaceScriptButtons([{name:'聊天管理器',visible:!0}]),eventOn(getButtonEvent('聊天管理器'),()=>{errorCatched(_e)()}),console.info('[聊天管理器] 脚本已加载')}),$(window).on('pagehide',()=>{Be(),$(`div[script_id="${getScriptId()}"]`).remove()});
//# sourceMappingURL=index.js.map