import{createPinia as e,defineStore as n}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{klona as t}from'https://testingcf.jsdelivr.net/npm/klona/+esm';var a={20(e,n,t){t.r(n),t.d(n,{default:()=>A});var a=t(492),o=t.n(a),r=t(748),c=t.n(r)()(o());c.push([e.id,'.chat-card[data-v-78cb2cb6]{display:flex;align-items:center;gap:8px;padding:8px 8px 8px 6px;border-radius:6px;cursor:pointer;transition:background-color .15s ease;position:relative;flex:1;margin-left:4px;background-color:hsla(0,0%,100%,.02)}.chat-card[data-v-78cb2cb6]:hover{background-color:hsla(0,0%,100%,.08)}.chat-card.is-selected[data-v-78cb2cb6]{background-color:rgba(59,130,246,.15)}.chat-card.is-current[data-v-78cb2cb6]{border-left:3px solid #22c55e;background-color:rgba(34,197,94,.1)}.chat-card.is-checkpoint[data-v-78cb2cb6]{opacity:.8}.expand-btn[data-v-78cb2cb6]{width:20px;height:20px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;opacity:.7}.expand-btn[data-v-78cb2cb6]:hover{opacity:1}.expand-placeholder[data-v-78cb2cb6]{width:20px}input[type=checkbox][data-v-78cb2cb6]{width:16px;height:16px;cursor:pointer}.chat-icon[data-v-78cb2cb6]{color:var(--SmartThemeBodyColor,#aaa);font-size:14px}.chat-info[data-v-78cb2cb6]{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}.chat-header[data-v-78cb2cb6]{display:flex;align-items:center;gap:6px}.chat-name[data-v-78cb2cb6]{font-weight:500;color:var(--SmartThemeBodyColor,#fff);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.current-badge[data-v-78cb2cb6],.checkpoint-badge[data-v-78cb2cb6]{font-size:10px;padding:1px 4px;border-radius:3px;font-weight:500}.current-badge[data-v-78cb2cb6]{background-color:#22c55e;color:#fff}.checkpoint-badge[data-v-78cb2cb6]{background-color:#f59e0b;color:#fff}.chat-meta[data-v-78cb2cb6]{display:flex;gap:12px;font-size:11px;color:var(--SmartThemeBodyColor,#888);opacity:.7}.chat-meta i[data-v-78cb2cb6]{margin-right:3px}.chat-preview[data-v-78cb2cb6]{font-size:12px;color:var(--SmartThemeBodyColor,#999);opacity:.6;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.chat-actions[data-v-78cb2cb6]{display:flex;gap:4px;opacity:0;transition:opacity .15s ease}.chat-card:hover .chat-actions[data-v-78cb2cb6]{opacity:1}.action-btn[data-v-78cb2cb6]{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.1);border:none;border-radius:4px;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;transition:all .15s ease}.action-btn[data-v-78cb2cb6]:hover{background:hsla(0,0%,100%,.2)}.action-btn.danger[data-v-78cb2cb6]:hover{background:rgba(239,68,68,.3);color:#ef4444}.action-btn[data-v-78cb2cb6]:disabled{opacity:.3;cursor:not-allowed}','',{version:3,sources:['webpack://./src/聊天管理器/components/ChatCard.vue'],names:[],mappings:'AACA,4BACE,YAAA,CACA,kBAAA,CACA,OAAA,CACA,uBAAA,CACA,iBAAA,CACA,cAAA,CACA,qCAAA,CACA,iBAAA,CACA,MAAA,CACA,eAAA,CACA,oCAAA,CAEA,kCACE,oCAAA,CAGF,wCACE,qCAAA,CAGF,uCACE,6BAAA,CACA,mCAAA,CAGF,0CACE,UAAA,CAIJ,6BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,UAAA,CAEA,mCACE,SAAA,CAIJ,qCACE,UAAA,CAGF,sCACE,UAAA,CACA,WAAA,CACA,cAAA,CAGF,4BACE,qCAAA,CACA,cAAA,CAGF,4BACE,MAAA,CACA,WAAA,CACA,YAAA,CACA,qBAAA,CACA,OAAA,CAGF,8BACE,YAAA,CACA,kBAAA,CACA,OAAA,CAGF,4BACE,eAAA,CACA,qCAAA,CACA,eAAA,CACA,sBAAA,CACA,kBAAA,CAGF,mEAEE,cAAA,CACA,eAAA,CACA,iBAAA,CACA,eAAA,CAGF,gCACE,wBAAA,CACA,UAAA,CAGF,mCACE,wBAAA,CACA,UAAA,CAGF,4BACE,YAAA,CACA,QAAA,CACA,cAAA,CACA,qCAAA,CACA,UAAA,CAEA,8BACE,gBAAA,CAIJ,+BACE,cAAA,CACA,qCAAA,CACA,UAAA,CACA,eAAA,CACA,sBAAA,CACA,kBAAA,CAGF,+BACE,YAAA,CACA,OAAA,CACA,SAAA,CACA,4BAAA,CAEA,gDACE,SAAA,CAIJ,6BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,6BAAA,CACA,WAAA,CACA,iBAAA,CACA,qCAAA,CACA,cAAA,CACA,wBAAA,CAEA,mCACE,6BAAA,CAGF,0CACE,6BAAA,CACA,aAAA,CAGF,sCACE,UAAA,CACA,kBAAA',sourcesContent:['\n.chat-card {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 8px 8px 6px;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: background-color 0.15s ease;\n  position: relative;\n  flex: 1; // 让卡片填充剩余空间\n  margin-left: 4px; // 与分支线保持小间距\n  background-color: rgba(255, 255, 255, 0.02); // 默认背景让边界更清晰\n\n  &:hover {\n    background-color: rgba(255, 255, 255, 0.08);\n  }\n\n  &.is-selected {\n    background-color: rgba(59, 130, 246, 0.15);\n  }\n\n  &.is-current {\n    border-left: 3px solid #22c55e;\n    background-color: rgba(34, 197, 94, 0.1);\n  }\n\n  &.is-checkpoint {\n    opacity: 0.8;\n  }\n}\n\n.expand-btn {\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  opacity: 0.7;\n\n  &:hover {\n    opacity: 1;\n  }\n}\n\n.expand-placeholder {\n  width: 20px;\n}\n\ninput[type=\'checkbox\'] {\n  width: 16px;\n  height: 16px;\n  cursor: pointer;\n}\n\n.chat-icon {\n  color: var(--SmartThemeBodyColor, #aaa);\n  font-size: 14px;\n}\n\n.chat-info {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n\n.chat-header {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.chat-name {\n  font-weight: 500;\n  color: var(--SmartThemeBodyColor, #fff);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.current-badge,\n.checkpoint-badge {\n  font-size: 10px;\n  padding: 1px 4px;\n  border-radius: 3px;\n  font-weight: 500;\n}\n\n.current-badge {\n  background-color: #22c55e;\n  color: #fff;\n}\n\n.checkpoint-badge {\n  background-color: #f59e0b;\n  color: #fff;\n}\n\n.chat-meta {\n  display: flex;\n  gap: 12px;\n  font-size: 11px;\n  color: var(--SmartThemeBodyColor, #888);\n  opacity: 0.7;\n\n  i {\n    margin-right: 3px;\n  }\n}\n\n.chat-preview {\n  font-size: 12px;\n  color: var(--SmartThemeBodyColor, #999);\n  opacity: 0.6;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.chat-actions {\n  display: flex;\n  gap: 4px;\n  opacity: 0;\n  transition: opacity 0.15s ease;\n\n  .chat-card:hover & {\n    opacity: 1;\n  }\n}\n\n.action-btn {\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(255, 255, 255, 0.1);\n  border: none;\n  border-radius: 4px;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  transition: all 0.15s ease;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.2);\n  }\n\n  &.danger:hover {\n    background: rgba(239, 68, 68, 0.3);\n    color: #ef4444;\n  }\n\n  &:disabled {\n    opacity: 0.3;\n    cursor: not-allowed;\n  }\n}\n'],sourceRoot:''}]);const A=c},183(e,n,t){var a=t(275);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('79fad248',a,!1,{ssrId:!0})},190(e,n,t){t.r(n),t.d(n,{default:()=>A});var a=t(492),o=t.n(a),r=t(748),c=t.n(r)()(o());c.push([e.id,'.forest-view[data-v-48ccc30e]{flex:1;overflow-y:auto;padding:8px}.forest-list[data-v-48ccc30e]{display:flex;flex-direction:column;gap:12px}.tree-group[data-v-48ccc30e]{background:hsla(0,0%,100%,.02);border:1px solid hsla(0,0%,100%,.08);border-radius:8px;overflow:hidden}.tree-header[data-v-48ccc30e]{display:flex;align-items:center;gap:10px;padding:12px 14px;background:rgba(0,0,0,.15);cursor:pointer;transition:background .15s}.tree-header[data-v-48ccc30e]:hover{background:rgba(0,0,0,.25)}.tree-header.has-current[data-v-48ccc30e]{border-left:3px solid #22c55e;background:rgba(34,197,94,.08)}.expand-btn[data-v-48ccc30e]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;opacity:.7}.expand-btn[data-v-48ccc30e]:hover{opacity:1}.tree-icon[data-v-48ccc30e]{font-size:16px;color:var(--SmartThemeBodyColor,#aaa);opacity:.8}.tree-info[data-v-48ccc30e]{flex:1;display:flex;align-items:center;gap:8px;min-width:0}.tree-name[data-v-48ccc30e]{font-weight:500;color:var(--SmartThemeBodyColor,#fff);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.current-badge[data-v-48ccc30e]{font-size:10px;padding:2px 6px;border-radius:4px;background:#22c55e;color:#fff;font-weight:500}.tree-meta[data-v-48ccc30e]{display:flex;gap:14px;font-size:12px;color:var(--SmartThemeBodyColor,#888);opacity:.7}.tree-meta i[data-v-48ccc30e]{margin-right:4px}.select-all-btn[data-v-48ccc30e]{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#aaa);cursor:pointer;opacity:.6;transition:all .15s}.select-all-btn[data-v-48ccc30e]:hover{opacity:1;color:#3b82f6}.tree-nodes[data-v-48ccc30e]{padding:4px;display:flex;flex-direction:column;gap:0}.tree-row[data-v-48ccc30e]{display:flex;align-items:stretch}.branch-cell[data-v-48ccc30e]{display:flex;flex-shrink:0;align-self:stretch}.continuation-line[data-v-48ccc30e],.branch-line[data-v-48ccc30e]{display:block;position:relative;flex:0 0 20px;width:20px;min-height:100%}.continuation-line.active[data-v-48ccc30e]::after{content:"";position:absolute;left:50%;top:-1px;bottom:-1px;width:2px;transform:translateX(-50%);background:rgba(0,200,200,.5)}.branch-line[data-v-48ccc30e]::before{content:"";position:absolute;left:50%;top:-1px;width:2px;height:calc(50% + 1px);transform:translateX(-50%);background:rgba(0,200,200,.5)}.branch-line[data-v-48ccc30e]::after{content:"";position:absolute;left:50%;top:50%;right:0;height:2px;transform:translateY(-50%);background:rgba(0,200,200,.5)}.branch-line[data-v-48ccc30e]:not(.is-last)::before{height:calc(100% + 2px);bottom:-1px}.empty-state[data-v-48ccc30e]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:var(--SmartThemeBodyColor,#888);opacity:.6}.empty-state i[data-v-48ccc30e]{font-size:56px;margin-bottom:16px}.empty-state p[data-v-48ccc30e]{margin:0;font-size:15px}.list-enter-active[data-v-48ccc30e],.list-leave-active[data-v-48ccc30e]{transition:all .2s ease}.list-enter-from[data-v-48ccc30e],.list-leave-to[data-v-48ccc30e]{opacity:0;transform:translateX(-10px)}.list-move[data-v-48ccc30e]{transition:transform .2s ease}','',{version:3,sources:['webpack://./src/聊天管理器/components/ForestView.vue'],names:[],mappings:'AACA,8BACE,MAAA,CACA,eAAA,CACA,WAAA,CAGF,8BACE,YAAA,CACA,qBAAA,CACA,QAAA,CAGF,6BACE,8BAAA,CACA,oCAAA,CACA,iBAAA,CACA,eAAA,CAGF,8BACE,YAAA,CACA,kBAAA,CACA,QAAA,CACA,iBAAA,CACA,0BAAA,CACA,cAAA,CACA,0BAAA,CAEA,oCACE,0BAAA,CAGF,0CACE,6BAAA,CACA,8BAAA,CAIJ,6BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,UAAA,CAEA,mCACE,SAAA,CAIJ,4BACE,cAAA,CACA,qCAAA,CACA,UAAA,CAGF,4BACE,MAAA,CACA,YAAA,CACA,kBAAA,CACA,OAAA,CACA,WAAA,CAGF,4BACE,eAAA,CACA,qCAAA,CACA,eAAA,CACA,sBAAA,CACA,kBAAA,CAGF,gCACE,cAAA,CACA,eAAA,CACA,iBAAA,CACA,kBAAA,CACA,UAAA,CACA,eAAA,CAGF,4BACE,YAAA,CACA,QAAA,CACA,cAAA,CACA,qCAAA,CACA,UAAA,CAEA,8BACE,gBAAA,CAIJ,iCACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,UAAA,CACA,mBAAA,CAEA,uCACE,SAAA,CACA,aAAA,CAIJ,6BACE,WAAA,CACA,YAAA,CACA,qBAAA,CACA,KAAA,CAIF,2BACE,YAAA,CACA,mBAAA,CAIF,8BACE,YAAA,CACA,aAAA,CACA,kBAAA,CAIF,kEAEE,aAAA,CACA,iBAAA,CACA,aAAA,CACA,UAAA,CACA,eAAA,CAMA,kDACE,UAAA,CACA,iBAAA,CACA,QAAA,CACA,QAAA,CACA,WAAA,CACA,SAAA,CACA,0BAAA,CACA,6BAAA,CAOF,sCACE,UAAA,CACA,iBAAA,CACA,QAAA,CACA,QAAA,CACA,SAAA,CACA,sBAAA,CACA,0BAAA,CACA,6BAAA,CAIF,qCACE,UAAA,CACA,iBAAA,CACA,QAAA,CACA,OAAA,CACA,OAAA,CACA,UAAA,CACA,0BAAA,CACA,6BAAA,CAIF,oDACE,uBAAA,CACA,WAAA,CAIJ,8BACE,YAAA,CACA,qBAAA,CACA,kBAAA,CACA,sBAAA,CACA,iBAAA,CACA,qCAAA,CACA,UAAA,CAEA,gCACE,cAAA,CACA,kBAAA,CAGF,gCACE,QAAA,CACA,cAAA,CAKJ,wEAEE,uBAAA,CAGF,kEAEE,SAAA,CACA,2BAAA,CAGF,4BACE,6BAAA',sourcesContent:['\n.forest-view {\n  flex: 1;\n  overflow-y: auto;\n  padding: 8px;\n}\n\n.forest-list {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.tree-group {\n  background: rgba(255, 255, 255, 0.02);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.tree-header {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 12px 14px;\n  background: rgba(0, 0, 0, 0.15);\n  cursor: pointer;\n  transition: background 0.15s;\n\n  &:hover {\n    background: rgba(0, 0, 0, 0.25);\n  }\n\n  &.has-current {\n    border-left: 3px solid #22c55e;\n    background: rgba(34, 197, 94, 0.08);\n  }\n}\n\n.expand-btn {\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  opacity: 0.7;\n\n  &:hover {\n    opacity: 1;\n  }\n}\n\n.tree-icon {\n  font-size: 16px;\n  color: var(--SmartThemeBodyColor, #aaa);\n  opacity: 0.8;\n}\n\n.tree-info {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  min-width: 0;\n}\n\n.tree-name {\n  font-weight: 500;\n  color: var(--SmartThemeBodyColor, #fff);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.current-badge {\n  font-size: 10px;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: #22c55e;\n  color: #fff;\n  font-weight: 500;\n}\n\n.tree-meta {\n  display: flex;\n  gap: 14px;\n  font-size: 12px;\n  color: var(--SmartThemeBodyColor, #888);\n  opacity: 0.7;\n\n  i {\n    margin-right: 4px;\n  }\n}\n\n.select-all-btn {\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #aaa);\n  cursor: pointer;\n  opacity: 0.6;\n  transition: all 0.15s;\n\n  &:hover {\n    opacity: 1;\n    color: #3b82f6;\n  }\n}\n\n.tree-nodes {\n  padding: 4px;\n  display: flex;\n  flex-direction: column;\n  gap: 0; // 移除间隙，让分支线连续\n}\n\n// 每行：分支线 + 卡片\n.tree-row {\n  display: flex;\n  align-items: stretch;\n}\n\n// 分支线单元格 - 独立于卡片，不受卡片背景影响\n.branch-cell {\n  display: flex;\n  flex-shrink: 0;\n  align-self: stretch;\n}\n\n// 延续线和分支线的公共样式\n.continuation-line,\n.branch-line {\n  display: block; // 确保能正确获取高度\n  position: relative;\n  flex: 0 0 20px; // 固定宽度，不压缩不拉伸\n  width: 20px;\n  min-height: 100%;\n}\n\n// 祖先延续线容器\n.continuation-line {\n  // 有后续兄弟节点时显示垂直线\n  &.active::after {\n    content: \'\';\n    position: absolute;\n    left: 50%;\n    top: -1px; // 延伸超出边界消除间隙\n    bottom: -1px;\n    width: 2px;\n    transform: translateX(-50%);\n    background: rgba(0, 200, 200, 0.5);\n  }\n}\n\n// L形连接线\n.branch-line {\n  // 垂直部分\n  &::before {\n    content: \'\';\n    position: absolute;\n    left: 50%;\n    top: -1px; // 延伸超出边界消除间隙\n    width: 2px;\n    height: calc(50% + 1px);\n    transform: translateX(-50%);\n    background: rgba(0, 200, 200, 0.5);\n  }\n\n  // 水平部分\n  &::after {\n    content: \'\';\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    right: 0;\n    height: 2px;\n    transform: translateY(-50%);\n    background: rgba(0, 200, 200, 0.5);\n  }\n\n  // 非最后一个子节点：垂直线贯穿整个高度\n  &:not(.is-last)::before {\n    height: calc(100% + 2px); // 延伸超出边界\n    bottom: -1px;\n  }\n}\n\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 60px 20px;\n  color: var(--SmartThemeBodyColor, #888);\n  opacity: 0.6;\n\n  i {\n    font-size: 56px;\n    margin-bottom: 16px;\n  }\n\n  p {\n    margin: 0;\n    font-size: 15px;\n  }\n}\n\n// 列表动画\n.list-enter-active,\n.list-leave-active {\n  transition: all 0.2s ease;\n}\n\n.list-enter-from,\n.list-leave-to {\n  opacity: 0;\n  transform: translateX(-10px);\n}\n\n.list-move {\n  transition: transform 0.2s ease;\n}\n'],sourceRoot:''}]);const A=c},275(e,n,t){t.r(n),t.d(n,{default:()=>A});var a=t(492),o=t.n(a),r=t(748),c=t.n(r)()(o());c.push([e.id,'.chat-manager-panel[data-v-34a25112]{display:flex;flex-direction:column;width:95vw;max-width:1200px;height:90vh;background:var(--SmartThemeBlurTintColor,#1a1a2e);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.4);overflow:hidden;color:var(--SmartThemeBodyColor,#e0e0e0)}.panel-header[data-v-34a25112]{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:rgba(0,0,0,.2);border-bottom:1px solid hsla(0,0%,100%,.1)}.panel-header h2[data-v-34a25112]{margin:0;font-size:18px;font-weight:600;display:flex;align-items:center;gap:8px}.panel-header h2 i[data-v-34a25112]{opacity:.8}.close-btn[data-v-34a25112]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;border-radius:6px;transition:background .15s}.close-btn[data-v-34a25112]:hover{background:hsla(0,0%,100%,.1)}.toolbar[data-v-34a25112]{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid hsla(0,0%,100%,.05)}.search-box[data-v-34a25112]{flex:1;display:flex;align-items:center;gap:8px;padding:8px 12px;background:hsla(0,0%,100%,.05);border-radius:8px;border:1px solid hsla(0,0%,100%,.1)}.search-box i[data-v-34a25112]{opacity:.5}.search-box input[data-v-34a25112]{flex:1;background:rgba(0,0,0,0);border:none;outline:none;color:inherit;font-size:14px}.search-box input[data-v-34a25112]::placeholder{color:var(--SmartThemeBodyColor,#888);opacity:.5}.clear-btn[data-v-34a25112]{background:rgba(0,0,0,0);border:none;color:var(--SmartThemeBodyColor,#888);cursor:pointer;opacity:.6}.clear-btn[data-v-34a25112]:hover{opacity:1}.toolbar-actions[data-v-34a25112]{display:flex;align-items:center;gap:8px}.sort-select[data-v-34a25112]{padding:6px 10px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;color:inherit;font-size:13px;cursor:pointer}.sort-select option[data-v-34a25112]{background:var(--SmartThemeBlurTintColor,#1a1a2e)}.icon-btn[data-v-34a25112]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;color:var(--SmartThemeBodyColor,#ccc);cursor:pointer;transition:all .15s}.icon-btn[data-v-34a25112]:hover{background:hsla(0,0%,100%,.1)}.batch-bar[data-v-34a25112]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:rgba(0,0,0,.1);border-bottom:1px solid hsla(0,0%,100%,.05)}.select-all[data-v-34a25112]{display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px}.select-all input[data-v-34a25112]{cursor:pointer}.batch-actions[data-v-34a25112]{display:flex;gap:8px}.batch-btn[data-v-34a25112]{display:flex;align-items:center;gap:4px;padding:6px 10px;background:hsla(0,0%,100%,.05);border:1px solid hsla(0,0%,100%,.1);border-radius:6px;color:var(--SmartThemeBodyColor,#ccc);font-size:12px;cursor:pointer;transition:all .15s}.batch-btn[data-v-34a25112]:hover:not(:disabled){background:hsla(0,0%,100%,.1)}.batch-btn[data-v-34a25112]:disabled{opacity:.4;cursor:not-allowed}.batch-btn.danger[data-v-34a25112]:hover:not(:disabled){background:rgba(239,68,68,.2);border-color:rgba(239,68,68,.3);color:#ef4444}.status-bar[data-v-34a25112]{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;font-size:12px;color:var(--SmartThemeBodyColor,#888);opacity:.7;border-top:1px solid hsla(0,0%,100%,.05);background:rgba(0,0,0,.1)}.status-bar .error[data-v-34a25112]{color:#ef4444;opacity:1}.status-bar .error i[data-v-34a25112]{margin-right:4px}.status-bar .cache-info[data-v-34a25112]{display:flex;align-items:center;gap:6px}.status-bar .cache-info i[data-v-34a25112]{margin-right:3px}.status-bar .refreshing-indicator[data-v-34a25112]{background:rgba(0,0,0,0);border:none;color:inherit;padding:0;margin-left:4px}','',{version:3,sources:['webpack://./src/聊天管理器/components/MainPanel.vue'],names:[],mappings:'AACA,qCACE,YAAA,CACA,qBAAA,CACA,UAAA,CACA,gBAAA,CACA,WAAA,CACA,iDAAA,CACA,kBAAA,CACA,oCAAA,CACA,eAAA,CACA,wCAAA,CAGF,+BACE,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,iBAAA,CACA,yBAAA,CACA,0CAAA,CAEA,kCACE,QAAA,CACA,cAAA,CACA,eAAA,CACA,YAAA,CACA,kBAAA,CACA,OAAA,CAEA,oCACE,UAAA,CAKN,4BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,iBAAA,CACA,0BAAA,CAEA,kCACE,6BAAA,CAIJ,0BACE,YAAA,CACA,kBAAA,CACA,QAAA,CACA,iBAAA,CACA,2CAAA,CAGF,6BACE,MAAA,CACA,YAAA,CACA,kBAAA,CACA,OAAA,CACA,gBAAA,CACA,8BAAA,CACA,iBAAA,CACA,mCAAA,CAEA,+BACE,UAAA,CAGF,mCACE,MAAA,CACA,wBAAA,CACA,WAAA,CACA,YAAA,CACA,aAAA,CACA,cAAA,CAEA,gDACE,qCAAA,CACA,UAAA,CAKN,4BACE,wBAAA,CACA,WAAA,CACA,qCAAA,CACA,cAAA,CACA,UAAA,CAEA,kCACE,SAAA,CAIJ,kCACE,YAAA,CACA,kBAAA,CACA,OAAA,CAGF,8BACE,gBAAA,CACA,8BAAA,CACA,mCAAA,CACA,iBAAA,CACA,aAAA,CACA,cAAA,CACA,cAAA,CAEA,qCACE,iDAAA,CAIJ,2BACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,8BAAA,CACA,mCAAA,CACA,iBAAA,CACA,qCAAA,CACA,cAAA,CACA,mBAAA,CAEA,iCACE,6BAAA,CAIJ,4BACE,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,gBAAA,CACA,yBAAA,CACA,2CAAA,CAGF,6BACE,YAAA,CACA,kBAAA,CACA,OAAA,CACA,cAAA,CACA,cAAA,CAEA,mCACE,cAAA,CAIJ,gCACE,YAAA,CACA,OAAA,CAGF,4BACE,YAAA,CACA,kBAAA,CACA,OAAA,CACA,gBAAA,CACA,8BAAA,CACA,mCAAA,CACA,iBAAA,CACA,qCAAA,CACA,cAAA,CACA,cAAA,CACA,mBAAA,CAEA,iDACE,6BAAA,CAGF,qCACE,UAAA,CACA,kBAAA,CAGF,wDACE,6BAAA,CACA,+BAAA,CACA,aAAA,CAIJ,6BACE,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,iBAAA,CACA,cAAA,CACA,qCAAA,CACA,UAAA,CACA,wCAAA,CACA,yBAAA,CAEA,oCACE,aAAA,CACA,SAAA,CAEA,sCACE,gBAAA,CAIJ,yCACE,YAAA,CACA,kBAAA,CACA,OAAA,CAEA,2CACE,gBAAA,CAIJ,mDACE,wBAAA,CACA,WAAA,CACA,aAAA,CACA,SAAA,CACA,eAAA',sourcesContent:['\n.chat-manager-panel {\n  display: flex;\n  flex-direction: column;\n  width: 95vw;\n  max-width: 1200px;\n  height: 90vh;\n  background: var(--SmartThemeBlurTintColor, #1a1a2e);\n  border-radius: 12px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n  overflow: hidden;\n  color: var(--SmartThemeBodyColor, #e0e0e0);\n}\n\n.panel-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 16px 20px;\n  background: rgba(0, 0, 0, 0.2);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n\n  h2 {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n\n    i {\n      opacity: 0.8;\n    }\n  }\n}\n\n.close-btn {\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  border-radius: 6px;\n  transition: background 0.15s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.1);\n  }\n}\n\n.toolbar {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.search-box {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: 8px;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n\n  i {\n    opacity: 0.5;\n  }\n\n  input {\n    flex: 1;\n    background: transparent;\n    border: none;\n    outline: none;\n    color: inherit;\n    font-size: 14px;\n\n    &::placeholder {\n      color: var(--SmartThemeBodyColor, #888);\n      opacity: 0.5;\n    }\n  }\n}\n\n.clear-btn {\n  background: transparent;\n  border: none;\n  color: var(--SmartThemeBodyColor, #888);\n  cursor: pointer;\n  opacity: 0.6;\n\n  &:hover {\n    opacity: 1;\n  }\n}\n\n.toolbar-actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.sort-select {\n  padding: 6px 10px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  color: inherit;\n  font-size: 13px;\n  cursor: pointer;\n\n  option {\n    background: var(--SmartThemeBlurTintColor, #1a1a2e);\n  }\n}\n\n.icon-btn {\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  color: var(--SmartThemeBodyColor, #ccc);\n  cursor: pointer;\n  transition: all 0.15s;\n\n  &:hover {\n    background: rgba(255, 255, 255, 0.1);\n  }\n}\n\n.batch-bar {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 16px;\n  background: rgba(0, 0, 0, 0.1);\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.select-all {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  cursor: pointer;\n  font-size: 13px;\n\n  input {\n    cursor: pointer;\n  }\n}\n\n.batch-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.batch-btn {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 6px 10px;\n  background: rgba(255, 255, 255, 0.05);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 6px;\n  color: var(--SmartThemeBodyColor, #ccc);\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.15s;\n\n  &:hover:not(:disabled) {\n    background: rgba(255, 255, 255, 0.1);\n  }\n\n  &:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n  }\n\n  &.danger:hover:not(:disabled) {\n    background: rgba(239, 68, 68, 0.2);\n    border-color: rgba(239, 68, 68, 0.3);\n    color: #ef4444;\n  }\n}\n\n.status-bar {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 10px 16px;\n  font-size: 12px;\n  color: var(--SmartThemeBodyColor, #888);\n  opacity: 0.7;\n  border-top: 1px solid rgba(255, 255, 255, 0.05);\n  background: rgba(0, 0, 0, 0.1);\n\n  .error {\n    color: #ef4444;\n    opacity: 1;\n\n    i {\n      margin-right: 4px;\n    }\n  }\n\n  .cache-info {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n\n    i {\n      margin-right: 3px;\n    }\n  }\n\n  .refreshing-indicator {\n    background: transparent;\n    border: none;\n    color: inherit;\n    padding: 0;\n    margin-left: 4px;\n  }\n}\n'],sourceRoot:''}]);const A=c},408(e,n,t){var a=t(20);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('ad510270',a,!1,{ssrId:!0})},424(e,n,t){function a(e,n){for(var t=[],a={},o=0;o<n.length;o++){var r=n[o],c=r[0],A={id:e+':'+o,css:r[1],media:r[2],sourceMap:r[3]};a[c]?a[c].parts.push(A):t.push(a[c]={id:c,parts:[A]})}return t}t.d(n,{A:()=>u});var o='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!o)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},c=o&&(document.head||document.getElementsByTagName('head')[0]),A=null,i=0,l=!1,s=function(){},d=null,p='data-vue-ssr-id',C='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function u(e,n,t,o){l=t,d=o||{};var c=a(e,n);return f(c),function(n){for(var t=[],o=0;o<c.length;o++){var A=c[o];(i=r[A.id]).refs--,t.push(i)}n?f(c=a(e,n)):c=[];for(o=0;o<t.length;o++){var i;if(0===(i=t[o]).refs){for(var l=0;l<i.parts.length;l++)i.parts[l]();delete r[i.id]}}}}function f(e){for(var n=0;n<e.length;n++){var t=e[n],a=r[t.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](t.parts[o]);for(;o<t.parts.length;o++)a.parts.push(m(t.parts[o]));a.parts.length>t.parts.length&&(a.parts.length=t.parts.length)}else{var c=[];for(o=0;o<t.parts.length;o++)c.push(m(t.parts[o]));r[t.id]={id:t.id,refs:1,parts:c}}}}function h(){var e=document.createElement('style');return e.type='text/css',c.appendChild(e),e}function m(e){var n,t,a=document.querySelector('style['+p+'~="'+e.id+'"]');if(a){if(l)return s;a.parentNode.removeChild(a)}if(C){var o=i++;a=A||(A=h()),n=v.bind(null,a,o,!1),t=v.bind(null,a,o,!0)}else a=h(),n=x.bind(null,a),t=function(){a.parentNode.removeChild(a)};return n(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;n(e=a)}else t()}}var g,b=(g=[],function(e,n){return g[e]=n,g.filter(Boolean).join('\n')});function v(e,n,t,a){var o=t?'':a.css;if(e.styleSheet)e.styleSheet.cssText=b(n,o);else{var r=document.createTextNode(o),c=e.childNodes;c[n]&&e.removeChild(c[n]),c.length?e.insertBefore(r,c[n]):e.appendChild(r)}}function x(e,n){var t=n.css,a=n.media,o=n.sourceMap;if(a&&e.setAttribute('media',a),d.ssrId&&e.setAttribute(p,n.id),o&&(t+='\n/*# sourceURL='+o.sources[0]+' */',t+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},492(e){e.exports=function(e){var n=e[1],t=e[3];if(!t)return n;if('function'==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),o='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(a),r='/*# '.concat(o,' */');return[n].concat([r]).join('\n')}return[n].join('\n')}},502(e,n){n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t}},748(e){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t='',a=void 0!==n[5];return n[4]&&(t+='@supports ('.concat(n[4],') {')),n[2]&&(t+='@media '.concat(n[2],' {')),a&&(t+='@layer'.concat(n[5].length>0?' '.concat(n[5]):'',' {')),t+=e(n),a&&(t+='}'),n[2]&&(t+='}'),n[4]&&(t+='}'),t}).join('')},n.i=function(e,t,a,o,r){'string'==typeof e&&(e=[[null,e,void 0]]);var c={};if(a)for(var A=0;A<this.length;A++){var i=this[A][0];null!=i&&(c[i]=!0)}for(var l=0;l<e.length;l++){var s=[].concat(e[l]);a&&c[s[0]]||(void 0!==r&&(void 0===s[5]||(s[1]='@layer'.concat(s[5].length>0?' '.concat(s[5]):'',' {').concat(s[1],'}')),s[5]=r),t&&(s[2]?(s[1]='@media '.concat(s[2],' {').concat(s[1],'}'),s[2]=t):s[2]=t),o&&(s[4]?(s[1]='@supports ('.concat(s[4],') {').concat(s[1],'}'),s[4]=o):s[4]=''.concat(o)),n.push(s))}},n}},898(e,n,t){var a=t(190);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('79d1bfb8',a,!1,{ssrId:!0})}},o={};function r(e){var n=o[e];if(void 0!==n)return n.exports;var t=o[e]={id:e,exports:{}};return a[e](t,t.exports,r),t.exports}r.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return r.d(n,{a:n}),n},r.d=(e,n)=>{for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const c=Vue;function A(e){let n=e;for(;n.endsWith('.jsonl');)n=n.slice(0,-6);return{base:n,full:`${n}.jsonl`}}function i(e){const n=[/(\d{4}-\d{2}-\d{2})@(\d{2})h(\d{2})m(\d{2})s/,/(\d{4})(\d{2})(\d{2})-(\d{2})(\d{2})(\d{2})/,/(\d{13})/];for(const t of n){const a=e.match(t);if(a){if(t===n[0]){const[,e,n,t,o]=a;return new Date(`${e}T${n}:${t}:${o}`)}if(t===n[1]){const[,e,n,t,o,r,c]=a;return new Date(`${e}-${n}-${t}T${o}:${r}:${c}`)}if(t===n[2])return new Date(parseInt(a[1]))}}return null}function l(e,n){let t=e.replace(/\.jsonl?$/,'').replace(/\d{4}-\d{2}-\d{2}@\d{2}h\d{2}m\d{2}s\s*\d*ms/,'').replace(/\d{13}/,'').replace(new RegExp(`^${_.escapeRegExp(n)}\\s*-?\\s*`),'').trim();return t||(t=e.replace(/\.jsonl?$/,'')),t||'未命名聊天'}function s(e,n){if(!e)return'';const t=e.replace(/<[^>]+>/g,'').replace(/\*\*([^*]+)\*\*/g,'$1').replace(/\*([^*]+)\*/g,'$1').replace(/```[\s\S]*?```/g,'[代码块]').replace(/`([^`]+)`/g,'$1').replace(/\n+/g,' ').trim();return t.length<=n?t:t.slice(0,n)+'...'}function d(e){const n=e.includes('checkpoint')||e.includes('_cp_'),t=e.match(/_branch_from_(.+?)(?:_|\.)/);return{is_checkpoint:n,parent_hint:t?.[1]}}async function p(e=100){const n=getCharData('current');if(!n)return console.warn('[聊天管理器] 未选择角色卡'),[];const t=n.name,a=n.avatar,o=n.chat;console.info('[聊天管理器] 当前角色:',t,'当前聊天:',o);const r=(await async function(){try{const e=await fetch('/api/chats/recent',{method:'POST',headers:SillyTavern.getRequestHeaders(),body:JSON.stringify({metadata:!0,max:9999})});return e.ok?await e.json():(console.warn('[聊天管理器] 获取聊天 metadata 失败:',e.status),[])}catch(e){return console.error('[聊天管理器] 获取聊天 metadata 出错:',e),[]}}()).filter(e=>e.avatar===a);if(0===r.length){console.info('[聊天管理器] 原生 API 无数据，回退到 getChatHistoryBrief');const n=await getChatHistoryBrief('current');return n&&0!==n.length?function(e,n,t,a){const o=[];for(const r of e){const e=r.file_id,{base:c,full:p}=A(e),C=r.chat_items||0,u=r.mes||'',{is_checkpoint:f,parent_hint:h}=d(p),m=i(p)||new Date;o.push({file_id:c,file_name:p,display_name:l(p,n),created_at:m,updated_at:m,message_count:C,first_message_preview:s(u,a),last_message_preview:s(u,a),parent_chat:h,is_checkpoint:f,is_current:c===t||p===t})}return o}(n,t,o,e):(console.info('[聊天管理器] 该角色没有聊天记录'),[])}console.info('[聊天管理器] 获取到',r.length,'个聊天记录 (带 metadata)');const c=[];for(const n of r){const a=n.file_id,{base:r,full:p}=A(a);console.debug(`[聊天管理器] 清理文件名: "${a}" -> file_id="${r}", file_name="${p}"`);const C=n.chat_items||0,u=n.mes||'',f=n.chat_metadata?.main_chat,{is_checkpoint:h}=d(p),m=i(p)||new Date;c.push({file_id:r,file_name:p,display_name:l(p,t),created_at:m,updated_at:m,message_count:C,first_message_preview:s(u,e),last_message_preview:s(u,e),parent_chat:f,is_checkpoint:h,is_current:r===o||p===o})}return console.info('[聊天管理器] 解析完成，共',c.length,'个聊天记录'),c}function C(e,n){const t=[...e],a='asc'===n.order?1:-1;return t.sort((e,t)=>{switch(n.by){case'updated_at':return a*(e.updated_at.getTime()-t.updated_at.getTime());case'created_at':return a*(e.created_at.getTime()-t.created_at.getTime());case'name':return a*e.display_name.localeCompare(t.display_name);case'message_count':return a*(e.message_count-t.message_count);default:return 0}}),t}function u(e){const n=[];return e.forEach(function e(t){t.is_selected&&n.push(t),t.children.forEach(e)}),n}function f(e,n){e.forEach(function e(t){t.is_selected=n,t.children.forEach(e)})}function h(e,n){e.forEach(function e(t){t.is_expanded=n,t.children.forEach(e)})}async function m(e,n){const{detect_branches:t=!0,sort_config:a}=n||{},o=C(e,a||{by:'updated_at',order:'desc'});let r=new Map;if(t){r=await async function(e){const n=new Map,t=new Map;for(const n of e)t.set(n.file_id,n.file_id),t.set(n.file_name,n.file_id),t.set(n.file_name.replace(/\.jsonl?$/,''),n.file_id);for(const a of e)if(a.parent_chat){const e=t.get(a.parent_chat);e&&e!==a.file_id&&(n.set(a.file_id,e),console.info(`[聊天管理器] 分支关系: ${a.file_id} -> ${e}`))}return console.info(`[聊天管理器] 检测到 ${n.size} 个分支关系`),n}(o);for(const e of o)!e.parent_chat&&r.has(e.file_id)&&(e.parent_chat=r.get(e.file_id))}const c=new Map;for(const e of o)c.set(e.file_id,{chat:e,children:[],depth:0,is_expanded:!0,is_selected:!1});const A=[];for(const e of o){const n=c.get(e.file_id);if(e.parent_chat&&c.has(e.parent_chat)){const t=c.get(e.parent_chat);n.depth=t.depth+1,t.children.push(n)}else A.push(n)}A.forEach(function e(n){n.children.length>0&&(n.children.sort((e,n)=>n.chat.updated_at.getTime()-e.chat.updated_at.getTime()),n.children.forEach(e))});const i=A.map(e=>{const n=g(e),t=n.reduce((e,n)=>n.chat.updated_at>e?n.chat.updated_at:e,e.chat.updated_at),a=n.some(e=>e.chat.is_current);return{id:e.chat.file_id,root:e,display_name:e.chat.display_name,node_count:n.length,latest_update:t,has_current:a,is_expanded:a||n.length<=5}});return i.sort((e,n)=>e.has_current&&!n.has_current?-1:!e.has_current&&n.has_current?1:n.latest_update.getTime()-e.latest_update.getTime()),{trees:i,total_count:e.length}}function g(e){const n=[e];for(const t of e.children)n.push(...g(t));return n}const b={default_sort:{by:'updated_at',order:'desc'},preview_length:50,show_checkpoints:!0,confirm_delete:!0},v='chat_manager_settings';let x=null;const y=n('chat-manager',()=>{const e=(0,c.ref)((()=>{try{const e=getVariables({type:'global'})?.[v];return e?{...b,...e}:{...b}}catch{return{...b}}})()),n=(0,c.ref)(!1),a=(0,c.ref)(!1),o=(0,c.ref)(null),r=(0,c.ref)([]),A=(0,c.ref)({trees:[],total_count:0}),i=(0,c.ref)(''),l=(0,c.ref)(e.value.default_sort),s=(0,c.ref)(null),d=(0,c.computed)(()=>function(e,n){let t=[...e];if(!1===n.show_checkpoints&&(t=t.filter(e=>!e.is_checkpoint)),n.search?.trim()){const e=n.search.toLowerCase().trim();t=t.filter(n=>n.display_name.toLowerCase().includes(e)||n.first_message_preview.toLowerCase().includes(e)||n.last_message_preview.toLowerCase().includes(e))}return t}(r.value,{search:i.value,show_checkpoints:e.value.show_checkpoints})),C=(0,c.computed)(()=>function(e){const n=[];for(const t of e.trees)n.push(...u([t.root]));return n}(A.value)),g=(0,c.computed)(()=>C.value.length),y=(0,c.computed)(()=>function(e){return e.total_count}(A.value)),B=(0,c.computed)(()=>r.value.find(e=>e.is_current));function k(e){const n=getCharData('current');n&&(x={chats:e,timestamp:Date.now(),character:n.name},s.value=new Date)}async function E(t=!1){if(o.value=null,!t&&function(){if(!x)return!1;const e=getCharData('current');if(!e)return!1;const n=Date.now(),t=x.character===e.name,a=n-x.timestamp<3e5;return t&&a}()&&x)return console.info('[聊天管理器] 使用缓存数据'),r.value=x.chats,s.value=new Date(x.timestamp),await w(),void async function(){if(a.value)return;a.value=!0;try{const n=await p(e.value.preview_length);JSON.stringify(n.map(e=>e.file_id))!==JSON.stringify(r.value.map(e=>e.file_id))?(console.info('[聊天管理器] 后台刷新检测到变化，更新视图'),r.value=n,k(n),await w()):k(n)}catch(e){console.warn('[聊天管理器] 后台刷新失败:',e)}finally{a.value=!1}}();n.value=!0;try{const n=await p(e.value.preview_length);r.value=n,k(n),await w(),console.info(`[聊天管理器] 已加载 ${r.value.length} 个聊天记录`)}catch(e){o.value=e instanceof Error?e.message:'加载聊天记录失败',console.error('[聊天管理器]',o.value,e)}finally{n.value=!1}}async function w(){A.value=await m(d.value,{detect_branches:!0,sort_config:l.value})}function N(){x=null,s.value=null}async function S(e,n){console.log('[聊天管理器] deleteChatDirect 输入:',{avatar_url:e,chat_file:n});let t=n,a=0;for(;t.endsWith('.jsonl');)t=t.slice(0,-6),a++;const o=`${t}.jsonl`;console.log(`[聊天管理器] 文件名处理: 移除了 ${a} 个 .jsonl, 最终: ${o}`);const r=`chats/${e.replace('.png','')}/${o}`;console.log(`[聊天管理器] 预期服务器路径: ${r}`);try{const n=SillyTavern.getRequestHeaders(),t={avatar_url:e,chatfile:o};console.info('[聊天管理器] 请求详情:',{url:'/api/chats/delete',method:'POST',headers:JSON.stringify(n),body:JSON.stringify(t)});const a=await fetch('/api/chats/delete',{method:'POST',headers:n,body:JSON.stringify(t)}),r=await a.text();return console.info(`[聊天管理器] API 响应: status=${a.status}, statusText=${a.statusText}, body="${r}"`),a.ok?(console.info(`[聊天管理器] ✅ 删除成功: ${o}`),!0):(console.error(`[聊天管理器] ❌ 删除失败: HTTP ${a.status} - ${r}`),!1)}catch(e){return console.error('[聊天管理器] ❌ 删除请求异常:',e),!1}}async function T(e){if(console.log('[聊天管理器] ========== 开始删除操作 =========='),console.log('[聊天管理器] 要删除的 file_ids:',e),0===e.length)return;const n=getCharData('current');if(console.log('[聊天管理器] char_data:',JSON.stringify(n,null,2)),!n)return void console.error('[聊天管理器] 无法获取角色信息');const t=n.avatar;console.log('[聊天管理器] avatar_url:',t);const a=SillyTavern.getRequestHeaders();console.log('[聊天管理器] 验证请求头:',{'Content-Type':a['Content-Type'],'X-CSRF-TOKEN':a['X-CSRF-TOKEN']?'(已设置)':'(未设置)'});const o=new Map;for(const e of r.value)o.set(e.file_id,e.file_name);for(const n of e){const e=r.value.find(e=>e.file_id===n);console.log(`[聊天管理器] file_id "${n}" 对应的 ChatInfo:`,e)}const c=B.value?.file_id,A=c&&e.includes(c),i=new Set(e),l=[...r.value];r.value=r.value.filter(e=>!i.has(e.file_id)),await w();let s=0,d=0;const p=[];for(const n of e){const a=l.find(e=>e.file_id===n),o=a?.file_name||n;console.log(`[聊天管理器] 使用文件名: ${o} (来自 file_name: ${!!a?.file_name})`);await S(t,o)?s++:(d++,p.push(n)),e.length>1&&await new Promise(e=>setTimeout(e,100))}if(await new Promise(e=>setTimeout(e,500)),N(),await E(!0),A&&r.value.length>0){const e=r.value[0];await SillyTavern.openCharacterChat(e.file_id),e.is_current=!0}return d>0&&(console.warn(`[聊天管理器] 删除完成: 成功 ${s}, 失败 ${d}`,p),toastr.warning(`部分删除失败: 成功 ${s}, 失败 ${d}`)),{success_count:s,fail_count:d}}return(0,c.watch)(l,w,{deep:!0}),(0,c.watch)(()=>e.value.show_checkpoints,w),(0,c.watch)(i,w),{settings:e,is_loading:n,is_background_loading:a,error_message:o,chats:r,forest:A,search_keyword:i,sort_config:l,cache_time:s,filtered_chats:d,selected_nodes:C,selected_count:g,total_count:y,current_chat:B,loadChats:E,rebuildForest:w,selectAll:function(e){!function(e,n){for(const t of e.trees)f([t.root],n)}(A.value,e)},expandAll:function(e){!function(e,n){for(const t of e.trees)t.is_expanded=n,h([t.root],n)}(A.value,e)},openChat:async function(e){try{await SillyTavern.openCharacterChat(e),toastr.success('已切换聊天');for(const n of r.value)n.is_current=n.file_id===e}catch(e){toastr.error('切换聊天失败'),console.error('[聊天管理器] 切换聊天失败:',e)}},deleteChats:T,deleteSelected:async function(){const t=C.value.map(e=>e.chat.file_id);if(0!==t.length){if(e.value.confirm_delete){if(await SillyTavern.callGenericPopup(`确定要删除选中的 ${t.length} 个聊天记录吗？\n\n此操作不可撤销！`,SillyTavern.POPUP_TYPE.CONFIRM)!==SillyTavern.POPUP_RESULT.AFFIRMATIVE)return}try{n.value=!0,await T(t),toastr.success(`已删除 ${t.length} 个聊天记录`)}catch(e){toastr.error('删除聊天记录时出错')}finally{n.value=!1}}else toastr.warning('请先选择要删除的聊天记录')},renameChat:async function(e,n){try{await SillyTavern.renameChat(e,n),toastr.success('重命名成功'),await E()}catch(e){toastr.error('重命名失败'),console.error('[聊天管理器] 重命名失败:',e)}},saveSettings:function(){try{updateVariablesWith(n=>(n[v]=t(e.value),n),{type:'global'})}catch(e){console.error('[聊天管理器] 保存设置失败:',e)}},invalidateCache:N}}),B={key:1,class:'expand-placeholder'},k=['checked'],E={class:'chat-header'},w=['title'],N={key:0,class:'current-badge'},S={key:1,class:'checkpoint-badge'},T={class:'chat-meta'},V={class:'message-count'},F={class:'update-time'},U=['title'],I={class:'chat-actions'},D=['disabled'],M=(0,c.defineComponent)({__name:'ChatCard',props:{node:{}},emits:['toggle-expand','toggle-select','open','rename','delete'],setup(e){const n=e,t=(0,c.computed)(()=>n.node.chat.is_checkpoint?'fa fa-bookmark':n.node.children.length>0?'fa fa-folder-o':'fa fa-file-text-o');function a(e){const n=(new Date).getTime()-e.getTime(),t=Math.floor(n/6e4);if(t<1)return'刚刚';if(t<60)return`${t} 分钟前`;const a=Math.floor(t/60);if(a<24)return`${a} 小时前`;const o=Math.floor(a/24);return o<7?`${o} 天前`:e.toLocaleDateString('zh-CN',{year:'numeric',month:'short',day:'numeric'})}return(n,o)=>((0,c.openBlock)(),(0,c.createElementBlock)('div',{class:(0,c.normalizeClass)(['chat-card',{'is-current':e.node.chat.is_current,'is-selected':e.node.is_selected,'is-checkpoint':e.node.chat.is_checkpoint,'has-children':e.node.children.length>0}])},[(0,c.createCommentVNode)(' 展开/折叠按钮 '),e.node.children.length>0?((0,c.openBlock)(),(0,c.createElementBlock)('button',{key:0,class:'expand-btn',onClick:o[0]||(o[0]=(0,c.withModifiers)(e=>n.$emit('toggle-expand'),['stop']))},[(0,c.createElementVNode)('i',{class:(0,c.normalizeClass)(e.node.is_expanded?'fa fa-chevron-down':'fa fa-chevron-right')},null,2)])):((0,c.openBlock)(),(0,c.createElementBlock)('span',B)),(0,c.createCommentVNode)(' 选择框 '),(0,c.createElementVNode)('input',{type:'checkbox',checked:e.node.is_selected,onChange:o[1]||(o[1]=e=>n.$emit('toggle-select')),onClick:o[2]||(o[2]=(0,c.withModifiers)(()=>{},['stop']))},null,40,k),(0,c.createCommentVNode)(' 图标 '),(0,c.createElementVNode)('i',{class:(0,c.normalizeClass)([(0,c.unref)(t),'chat-icon'])},null,2),(0,c.createCommentVNode)(' 聊天信息 '),(0,c.createElementVNode)('div',{class:'chat-info',onClick:o[3]||(o[3]=e=>n.$emit('open'))},[(0,c.createElementVNode)('div',E,[(0,c.createElementVNode)('span',{class:'chat-name',title:e.node.chat.file_name},(0,c.toDisplayString)(e.node.chat.display_name),9,w),e.node.chat.is_current?((0,c.openBlock)(),(0,c.createElementBlock)('span',N,'当前')):(0,c.createCommentVNode)('v-if',!0),e.node.chat.is_checkpoint?((0,c.openBlock)(),(0,c.createElementBlock)('span',S,'检查点')):(0,c.createCommentVNode)('v-if',!0)]),(0,c.createElementVNode)('div',T,[(0,c.createElementVNode)('span',V,[o[7]||(o[7]=(0,c.createElementVNode)('i',{class:'fa fa-comment-o'},null,-1)),(0,c.createTextVNode)(' '+(0,c.toDisplayString)(e.node.chat.message_count)+' 条 ',1)]),(0,c.createElementVNode)('span',F,[o[8]||(o[8]=(0,c.createElementVNode)('i',{class:'fa fa-clock-o'},null,-1)),(0,c.createTextVNode)(' '+(0,c.toDisplayString)(a(e.node.chat.updated_at)),1)])]),(0,c.createElementVNode)('div',{class:'chat-preview',title:e.node.chat.last_message_preview},(0,c.toDisplayString)(e.node.chat.last_message_preview||'(空)'),9,U)]),(0,c.createCommentVNode)(' 操作按钮 '),(0,c.createElementVNode)('div',I,[(0,c.createElementVNode)('button',{class:'action-btn',title:'打开',onClick:o[4]||(o[4]=(0,c.withModifiers)(e=>n.$emit('open'),['stop']))},[...o[9]||(o[9]=[(0,c.createElementVNode)('i',{class:'fa fa-sign-out fa-flip-horizontal'},null,-1)])]),(0,c.createElementVNode)('button',{class:'action-btn',title:'重命名',onClick:o[5]||(o[5]=(0,c.withModifiers)(e=>n.$emit('rename'),['stop']))},[...o[10]||(o[10]=[(0,c.createElementVNode)('i',{class:'fa fa-pencil'},null,-1)])]),(0,c.createElementVNode)('button',{class:'action-btn danger',title:'删除',disabled:e.node.chat.is_current,onClick:o[6]||(o[6]=(0,c.withModifiers)(e=>n.$emit('delete'),['stop']))},[...o[11]||(o[11]=[(0,c.createElementVNode)('i',{class:'fa fa-trash-o'},null,-1)])],8,D)])],2))}});r(408);var O=r(502);const j=(0,O.A)(M,[['__scopeId','data-v-78cb2cb6']]),G={class:'forest-view'},P={key:0,class:'empty-state'},Y={key:1,class:'forest-list'},q=['onClick'],J={class:'expand-btn'},W={class:'tree-info'},R={class:'tree-name'},L={key:0,class:'current-badge'},Q={class:'tree-meta'},X={class:'node-count'},H={class:'update-time'},K=['onClick'],Z={class:'branch-cell'},ee=(0,c.defineComponent)({__name:'ForestView',props:{forest:{}},emits:['open-chat','rename-chat','delete-chat'],setup(e){function n(e){const n=[];return function e(t,a=[]){for(let o=0;o<t.length;o++){const r=t[o],c=o===t.length-1;n.push({node:r,isLastChild:c,ancestorContinuations:[...a]}),r.is_expanded&&r.children.length>0&&e(r.children,[...a,!c])}}([e.root]),n}function t(e){return function e(n){return!!n.is_selected&&n.children.every(e)}(e.root)}function a(e){const n=(new Date).getTime()-e.getTime(),t=Math.floor(n/6e4);if(t<1)return'刚刚';if(t<60)return`${t} 分钟前`;const a=Math.floor(t/60);if(a<24)return`${a} 小时前`;const o=Math.floor(a/24);return o<7?`${o} 天前`:e.toLocaleDateString('zh-CN',{year:'numeric',month:'short',day:'numeric'})}return(o,r)=>((0,c.openBlock)(),(0,c.createElementBlock)('div',G,[0===e.forest.trees.length?((0,c.openBlock)(),(0,c.createElementBlock)('div',P,[...r[0]||(r[0]=[(0,c.createElementVNode)('i',{class:'fa fa-inbox'},null,-1),(0,c.createElementVNode)('p',null,'暂无聊天记录',-1)])])):((0,c.openBlock)(),(0,c.createElementBlock)('div',Y,[((0,c.openBlock)(!0),(0,c.createElementBlock)(c.Fragment,null,(0,c.renderList)(e.forest.trees,e=>((0,c.openBlock)(),(0,c.createElementBlock)('div',{key:e.id,class:'tree-group'},[(0,c.createCommentVNode)(' 树标题栏 '),(0,c.createElementVNode)('div',{class:(0,c.normalizeClass)(['tree-header',{'has-current':e.has_current}]),onClick:n=>function(e){e.is_expanded=!e.is_expanded}(e)},[(0,c.createElementVNode)('button',J,[(0,c.createElementVNode)('i',{class:(0,c.normalizeClass)(e.is_expanded?'fa fa-chevron-down':'fa fa-chevron-right')},null,2)]),(0,c.createElementVNode)('i',{class:(0,c.normalizeClass)([e.node_count>1?'fa fa-code-fork':'fa fa-file-text-o','tree-icon'])},null,2),(0,c.createElementVNode)('div',W,[(0,c.createElementVNode)('span',R,(0,c.toDisplayString)(e.display_name),1),e.has_current?((0,c.openBlock)(),(0,c.createElementBlock)('span',L,'当前')):(0,c.createCommentVNode)('v-if',!0)]),(0,c.createElementVNode)('div',Q,[(0,c.createElementVNode)('span',X,[r[1]||(r[1]=(0,c.createElementVNode)('i',{class:'fa fa-comments-o'},null,-1)),(0,c.createTextVNode)(' '+(0,c.toDisplayString)(e.node_count)+' 个聊天 ',1)]),(0,c.createElementVNode)('span',H,[r[2]||(r[2]=(0,c.createElementVNode)('i',{class:'fa fa-clock-o'},null,-1)),(0,c.createTextVNode)(' '+(0,c.toDisplayString)(a(e.latest_update)),1)])]),(0,c.createElementVNode)('button',{class:'select-all-btn',title:'选择整棵树',onClick:(0,c.withModifiers)(n=>function(e,n){!function e(t){t.is_selected=n,t.children.forEach(e)}(e.root)}(e,!t(e)),['stop'])},[(0,c.createElementVNode)('i',{class:(0,c.normalizeClass)(t(e)?'fa fa-check-square-o':'fa fa-square-o')},null,2)],8,K)],10,q),(0,c.createCommentVNode)(' 树节点列表 '),e.is_expanded?((0,c.openBlock)(),(0,c.createBlock)(c.TransitionGroup,{key:0,name:'list',tag:'div',class:'tree-nodes'},{default:(0,c.withCtx)(()=>[((0,c.openBlock)(!0),(0,c.createElementBlock)(c.Fragment,null,(0,c.renderList)(n(e),e=>((0,c.openBlock)(),(0,c.createElementBlock)('div',{key:e.node.chat.file_id,class:'tree-row'},[(0,c.createCommentVNode)(' 分支线单元格 '),(0,c.createElementVNode)('div',Z,[(0,c.createCommentVNode)(' 祖先层级的垂直延续线 '),((0,c.openBlock)(!0),(0,c.createElementBlock)(c.Fragment,null,(0,c.renderList)(Math.max(0,e.node.depth-1),n=>((0,c.openBlock)(),(0,c.createElementBlock)('span',{key:'line-'+n,class:(0,c.normalizeClass)(['continuation-line',{active:e.ancestorContinuations[n-1]}])},null,2))),128)),(0,c.createCommentVNode)(' 当前节点的L形连接线 '),e.node.depth>0?((0,c.openBlock)(),(0,c.createElementBlock)('span',{key:0,class:(0,c.normalizeClass)(['branch-line',{'is-last':e.isLastChild}])},null,2)):(0,c.createCommentVNode)('v-if',!0)]),(0,c.createCommentVNode)(' 卡片内容 '),(0,c.createVNode)(j,{node:e.node,onToggleExpand:n=>{var t;(t=e.node).is_expanded=!t.is_expanded},onToggleSelect:n=>{var t;(t=e.node).is_selected=!t.is_selected},onOpen:n=>o.$emit('open-chat',e.node.chat.file_id),onRename:n=>o.$emit('rename-chat',e.node.chat.file_id),onDelete:n=>o.$emit('delete-chat',e.node.chat.file_id)},null,8,['node','onToggleExpand','onToggleSelect','onOpen','onRename','onDelete'])]))),128))]),_:2},1024)):(0,c.createCommentVNode)('v-if',!0)]))),128))]))]))}});r(898);const ne=(0,O.A)(ee,[['__scopeId','data-v-48ccc30e']]),te={class:'chat-manager-panel'},ae={class:'panel-header'},oe={class:'toolbar'},re={class:'search-box'},ce={class:'toolbar-actions'},Ae=['title'],ie={class:'batch-bar'},le={class:'select-all'},se=['checked','indeterminate'],de={class:'batch-actions'},pe=['disabled'],Ce=['disabled'],ue=['disabled'],fe={class:'status-bar'},he={key:0,class:'error'},me={key:0,class:'cache-info'},ge={key:0,class:'refreshing-indicator',disabled:''},be=(0,c.defineComponent)({__name:'MainPanel',emits:['close'],setup(e){const n=y(),t=(0,c.computed)({get:()=>n.sort_config.by,set:e=>{n.sort_config.by=e}}),a=(0,c.computed)({get:()=>n.sort_config.order,set:e=>{n.sort_config.order=e}});function o(){a.value='desc'===a.value?'asc':'desc'}const r=(0,c.computed)(()=>n.total_count>0&&n.selected_count===n.total_count),A=(0,c.computed)(()=>n.selected_count>0&&n.selected_count<n.total_count);function i(){n.selectAll(!r.value)}async function l(e){await n.openChat(e)}async function s(e){const t=n.chats.find(n=>n.file_id===e);if(!t)return;const a=await SillyTavern.callGenericPopup('请输入新的聊天名称:',SillyTavern.POPUP_TYPE.INPUT,t.display_name);a&&'string'==typeof a&&a.trim()&&await n.renameChat(e,a.trim())}async function d(e){const t=n.chats.find(n=>n.file_id===e);if(t)if(t.is_current)toastr.warning('无法删除当前正在使用的聊天');else{if(n.settings.confirm_delete){if(await SillyTavern.callGenericPopup(`确定要删除聊天 "${t.display_name}" 吗？\n\n此操作不可撤销！`,SillyTavern.POPUP_TYPE.CONFIRM)!==SillyTavern.POPUP_RESULT.AFFIRMATIVE)return}try{await n.deleteChats([e]),toastr.success('已删除聊天')}catch{toastr.error('删除失败')}}}function p(e){const n=new Date,t=Math.floor((n.getTime()-e.getTime())/1e3);return t<5?'刚刚':t<60?`${t}秒前`:t<3600?`${Math.floor(t/60)}分钟前`:'已过期'}return(0,c.onMounted)(()=>{n.loadChats()}),(e,C)=>((0,c.openBlock)(),(0,c.createElementBlock)('div',te,[(0,c.createCommentVNode)(' 标题栏 '),(0,c.createElementVNode)('div',ae,[C[9]||(C[9]=(0,c.createElementVNode)('h2',null,[(0,c.createElementVNode)('i',{class:'fa fa-comments-o'}),(0,c.createTextVNode)(' 聊天管理器 ')],-1)),(0,c.createElementVNode)('button',{class:'close-btn',onClick:C[0]||(C[0]=n=>e.$emit('close'))},[...C[8]||(C[8]=[(0,c.createElementVNode)('i',{class:'fa fa-times'},null,-1)])])]),(0,c.createCommentVNode)(' 工具栏 '),(0,c.createElementVNode)('div',oe,[(0,c.createElementVNode)('div',re,[C[11]||(C[11]=(0,c.createElementVNode)('i',{class:'fa fa-search'},null,-1)),(0,c.withDirectives)((0,c.createElementVNode)('input',{'onUpdate:modelValue':C[1]||(C[1]=e=>(0,c.unref)(n).search_keyword=e),type:'text',placeholder:'搜索聊天...'},null,512),[[c.vModelText,(0,c.unref)(n).search_keyword]]),(0,c.unref)(n).search_keyword?((0,c.openBlock)(),(0,c.createElementBlock)('button',{key:0,class:'clear-btn',onClick:C[2]||(C[2]=e=>(0,c.unref)(n).search_keyword='')},[...C[10]||(C[10]=[(0,c.createElementVNode)('i',{class:'fa fa-times-circle'},null,-1)])])):(0,c.createCommentVNode)('v-if',!0)]),(0,c.createElementVNode)('div',ce,[(0,c.withDirectives)((0,c.createElementVNode)('select',{'onUpdate:modelValue':C[3]||(C[3]=e=>(0,c.isRef)(t)?t.value=e:null),class:'sort-select'},[...C[12]||(C[12]=[(0,c.createElementVNode)('option',{value:'updated_at'},'按更新时间',-1),(0,c.createElementVNode)('option',{value:'created_at'},'按创建时间',-1),(0,c.createElementVNode)('option',{value:'name'},'按名称',-1),(0,c.createElementVNode)('option',{value:'message_count'},'按消息数',-1)])],512),[[c.vModelSelect,(0,c.unref)(t)]]),(0,c.createElementVNode)('button',{class:'icon-btn',title:'desc'===(0,c.unref)(a)?'降序':'升序',onClick:o},[(0,c.createElementVNode)('i',{class:(0,c.normalizeClass)('desc'===(0,c.unref)(a)?'fa fa-sort-amount-desc':'fa fa-sort-amount-asc')},null,2)],8,Ae),(0,c.createElementVNode)('button',{class:'icon-btn',title:'刷新',onClick:C[4]||(C[4]=e=>(0,c.unref)(n).loadChats())},[(0,c.createElementVNode)('i',{class:(0,c.normalizeClass)(['fa fa-refresh',{'fa-spin':(0,c.unref)(n).is_loading}])},null,2)])])]),(0,c.createCommentVNode)(' 批量操作栏 '),(0,c.createElementVNode)('div',ie,[(0,c.createElementVNode)('label',le,[(0,c.createElementVNode)('input',{type:'checkbox',checked:(0,c.unref)(r),indeterminate:(0,c.unref)(A),onChange:i},null,40,se),C[13]||(C[13]=(0,c.createElementVNode)('span',null,'全选',-1))]),(0,c.createElementVNode)('div',de,[(0,c.createElementVNode)('button',{class:'batch-btn',disabled:0===(0,c.unref)(n).selected_count,onClick:C[5]||(C[5]=e=>(0,c.unref)(n).expandAll(!0))},[...C[14]||(C[14]=[(0,c.createElementVNode)('i',{class:'fa fa-expand'},null,-1),(0,c.createTextVNode)(' 展开全部 ',-1)])],8,pe),(0,c.createElementVNode)('button',{class:'batch-btn',disabled:0===(0,c.unref)(n).selected_count,onClick:C[6]||(C[6]=e=>(0,c.unref)(n).expandAll(!1))},[...C[15]||(C[15]=[(0,c.createElementVNode)('i',{class:'fa fa-compress'},null,-1),(0,c.createTextVNode)(' 折叠全部 ',-1)])],8,Ce),(0,c.createElementVNode)('button',{class:'batch-btn danger',disabled:0===(0,c.unref)(n).selected_count,onClick:C[7]||(C[7]=e=>(0,c.unref)(n).deleteSelected())},[C[16]||(C[16]=(0,c.createElementVNode)('i',{class:'fa fa-trash-o'},null,-1)),(0,c.createTextVNode)(' 删除选中 ('+(0,c.toDisplayString)((0,c.unref)(n).selected_count)+') ',1)],8,ue)])]),(0,c.createCommentVNode)(' 聊天列表 '),(0,c.createVNode)(ne,{forest:(0,c.unref)(n).forest,onOpenChat:l,onRenameChat:s,onDeleteChat:d},null,8,['forest']),(0,c.createCommentVNode)(' 状态栏 '),(0,c.createElementVNode)('div',fe,[(0,c.unref)(n).error_message?((0,c.openBlock)(),(0,c.createElementBlock)('span',he,[C[17]||(C[17]=(0,c.createElementVNode)('i',{class:'fa fa-exclamation-triangle'},null,-1)),(0,c.createTextVNode)(' '+(0,c.toDisplayString)((0,c.unref)(n).error_message),1)])):((0,c.openBlock)(),(0,c.createElementBlock)(c.Fragment,{key:1},[(0,c.createElementVNode)('span',null,'已选中 '+(0,c.toDisplayString)((0,c.unref)(n).selected_count)+' 个 | 共 '+(0,c.toDisplayString)((0,c.unref)(n).total_count)+' 个聊天',1),(0,c.unref)(n).cache_time?((0,c.openBlock)(),(0,c.createElementBlock)('span',me,[C[19]||(C[19]=(0,c.createElementVNode)('i',{class:'fa fa-database'},null,-1)),(0,c.createTextVNode)(' 缓存: '+(0,c.toDisplayString)(p((0,c.unref)(n).cache_time))+' ',1),(0,c.unref)(n).is_background_loading?((0,c.openBlock)(),(0,c.createElementBlock)('button',ge,[...C[18]||(C[18]=[(0,c.createElementVNode)('i',{class:'fa fa-refresh fa-spin'},null,-1)])])):(0,c.createCommentVNode)('v-if',!0)])):(0,c.createCommentVNode)('v-if',!0)],64))])]))}});r(183);const ve=(0,O.A)(be,[['__scopeId','data-v-34a25112']]);let xe=!1,ye=null,_e=null;function Be(){if(xe)return void ke();if(!getCharData('current'))return void toastr.warning('请先选择一个角色卡');_e=$('<div>').attr('script_id',getScriptId()),_e.addClass('chat-manager-container'),_e.css({position:'fixed',top:0,left:0,right:0,bottom:0,display:'flex',alignItems:'center',justifyContent:'center',backgroundColor:'rgba(0, 0, 0, 0.5)',zIndex:9999}),_e.on('click',e=>{e.target===_e[0]&&ke()}),$(document).on('keydown.chat-manager',e=>{'Escape'===e.key&&ke()}),$('body').append(_e),function(){if($(`head > div[script_id="${getScriptId()}"]`).length>0)return;const e=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone());$('head').append(e)}();const n=$('<div>').appendTo(_e);ye=(0,c.createApp)(ve,{onClose:ke}),ye.use(e()),ye.mount(n[0]),xe=!0,console.info('[聊天管理器] 已打开')}function ke(){xe&&($(document).off('keydown.chat-manager'),ye&&(ye.unmount(),ye=null),_e&&(_e.remove(),_e=null),$(`head > div[script_id="${getScriptId()}"]`).remove(),xe=!1,console.info('[聊天管理器] 已关闭'))}$(()=>{replaceScriptButtons([{name:'聊天管理器',visible:!0}]),eventOn(getButtonEvent('聊天管理器'),()=>{errorCatched(Be)()}),console.info('[聊天管理器] 脚本已加载')}),$(window).on('pagehide',()=>{ke(),$(`div[script_id="${getScriptId()}"]`).remove()});
//# sourceMappingURL=index.js.map